<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertisseur Texte-Voix Professionnel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            padding: 40px;
            margin-top: 20px;
            margin-bottom: 40px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.8rem;
            background: linear-gradient(90deg, #1a2a6c, #b21f1f);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        .input-section, .controls-section, .voices-section, .apikey-section, .download-section {
            margin-bottom: 30px;
        }

        h2 {
            color: #34495e;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #ecf0f1;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1rem;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: #ddd;
            border-radius: 4px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
        }

        .value-display {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: #2c3e50;
        }

        .voices-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .voice-option {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .voice-option:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
        }

        .voice-option.selected {
            border-color: #2ecc71;
            background-color: #e8f6f3;
        }

        .voice-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .voice-lang {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .api-key-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .api-input-group {
            margin-bottom: 15px;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            margin-top: 8px;
        }

        .api-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 200px;
        }

        .play-btn {
            background: linear-gradient(90deg, #2ecc71, #1abc9c);
            color: white;
        }

        .play-btn:hover {
            background: linear-gradient(90deg, #27ae60, #16a085);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }

        .stop-btn {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
        }

        .stop-btn:hover {
            background: linear-gradient(90deg, #c0392b, #a93226);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .pause-btn {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
        }

        .pause-btn:hover {
            background: linear-gradient(90deg, #2980b9, #1c5a7d);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .download-btn {
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
            color: white;
        }

        .download-btn:hover {
            background: linear-gradient(90deg, #8e44ad, #6c3483);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4);
        }

        .generate-btn {
            background: linear-gradient(90deg, #f39c12, #e67e22);
            color: white;
        }

        .generate-btn:hover {
            background: linear-gradient(90deg, #e67e22, #d35400);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }

        .reset-btn {
            background: linear-gradient(90deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .reset-btn:hover {
            background: linear-gradient(90deg, #7f8c8d, #6c7b7d);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .status {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .status.ready {
            background-color: #e8f6f3;
            color: #27ae60;
        }

        .status.speaking {
            background-color: #ebf5fb;
            color: #2980b9;
        }

        .status.paused {
            background-color: #fef9e7;
            color: #f39c12;
        }

        .status.stopped {
            background-color: #fbebee;
            color: #e74c3c;
        }

        .status.processing {
            background-color: #f4ecf7;
            color: #8e44ad;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .audio-preview {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        audio {
            width: 100%;
            margin: 15px 0;
        }

        .example-text {
            margin-top: 10px;
            font-style: italic;
            color: #7f8c8d;
            cursor: pointer;
            text-decoration: underline;
            display: inline-block;
        }

        .example-text:hover {
            color: #3498db;
        }

        .instructions {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .instructions ul {
            padding-left: 20px;
            color: #555;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #3498db);
            width: 0%;
            transition: width 0.3s;
        }

        .format-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .format-btn {
            padding: 10px 20px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .format-btn.active {
            background: #3498db;
            color: white;
        }

        .quality-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 10px;
        }

        .quality-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            background: white;
        }

        .quality-btn.active {
            background: #2ecc71;
            color: white;
            border-color: #2ecc71;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            width: 100%;
        }

        .api-info {
            background: #FFECB3;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #FFA000;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .voice-option {
                min-width: 100%;
            }
            
            button {
                min-width: 100%;
            }
            
            .format-options, .quality-options {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Convertisseur Texte-Voix Pro</h1>
            <p class="subtitle">Qualit√© VoiceRSS + T√©l√©chargement MP3/WAV compatible</p>
        </header>

        <section class="apikey-section">
            <h2>1. Configuration VoiceRSS</h2>
            <div class="api-key-container">
                <div class="api-input-group">
                    <label for="voiceRSSKey">Cl√© API VoiceRSS :</label>
                    <input type="text" id="voiceRSSKey" class="api-input" placeholder="Entrez votre cl√© API VoiceRSS...">
                    <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                        Obtenez une cl√© gratuite sur <a href="https://www.voicerss.org/api/" target="_blank">voicerss.org</a>
                        (300 requ√™tes gratuites/jour)
                    </p>
                </div>
                
                <div class="api-input-group">
                    <label for="apiMethod">M√©thode de g√©n√©ration :</label>
                    <select id="apiMethod" class="api-input">
                        <option value="browser">Synth√®se vocale navigateur (gratuit)</option>
                        <option value="voicerss">VoiceRSS API (meilleure qualit√©)</option>
                        <option value="both">Les deux (test + t√©l√©chargement)</option>
                    </select>
                </div>
            </div>
        </section>

        <section class="input-section">
            <h2>2. Texte √† convertir</h2>
            <textarea id="textInput" placeholder="√âcrivez ou collez votre texte ici...">Bonjour ! Je suis votre assistant vocal professionnel utilisant VoiceRSS pour une qualit√© audio exceptionnelle.

La ponctuation sera parfaitement respect√©e : les virgules, les points, les points d'interrogation et d'exclamation.

Avec VoiceRSS, vous obtiendrez un fichier audio de haute qualit√©, parfaitement compatible avec Windows Media Player, VLC, et tous les lecteurs audio.</textarea>
            <div class="stats">
                <span id="charCount">0 caract√®res</span>
                <span id="wordCount">0 mots</span>
                <span id="sentenceCount">0 phrases</span>
            </div>
            <p class="example-text" id="loadExample">Charger un exemple de texte avec ponctuation</p>
        </section>

        <section class="controls-section">
            <h2>3. Param√®tres audio</h2>
            <div class="controls">
                <div class="control-group">
                    <label for="rate">Vitesse de parole</label>
                    <div class="slider-container">
                        <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1">
                        <span class="value-display" id="rateValue">1.0</span>
                    </div>
                </div>
                <div class="control-group">
                    <label for="pitch">Ton de la voix</label>
                    <div class="slider-container">
                        <input type="range" id="pitch" min="0.5" max="2" step="0.1" value="1">
                        <span class="value-display" id="pitchValue">1.0</span>
                    </div>
                </div>
                <div class="control-group">
                    <label for="volume">Volume</label>
                    <div class="slider-container">
                        <input type="range" id="volume" min="0" max="1" step="0.1" value="1">
                        <span class="value-display" id="volumeValue">1.0</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="voices-section">
            <h2>4. S√©lectionnez une voix</h2>
            <p id="voicesLoading">Chargement des voix disponibles...</p>
            <div class="voices-container" id="voicesContainer">
                <!-- Les options de voix seront ajout√©es dynamiquement -->
            </div>
            
            <div class="format-options">
                <div class="format-btn active" data-format="mp3">MP3 (Recommand√©)</div>
                <div class="format-btn" data-format="wav">WAV (Haute qualit√©)</div>
                <div class="format-btn" data-format="ogg">OGG</div>
            </div>
            
            <div class="quality-options">
                <div class="quality-btn active" data-quality="high">Haute qualit√©</div>
                <div class="quality-btn" data-quality="medium">Qualit√© moyenne</div>
                <div class="quality-btn" data-quality="low">Basse qualit√©</div>
            </div>
        </section>

        <div class="buttons">
            <button id="playBtn" class="play-btn">
                <span>‚ñ∂ √âcouter (Navigateur)</span>
            </button>
            <button id="generateBtn" class="generate-btn">
                <span>‚ö° G√©n√©rer avec VoiceRSS</span>
            </button>
            <button id="downloadBtn" class="download-btn" disabled>
                <span>‚¨á T√©l√©charger Audio</span>
            </button>
            <button id="stopBtn" class="stop-btn" disabled>
                <span>‚èπ Arr√™ter</span>
            </button>
            <button id="resetBtn" class="reset-btn">
                <span>‚Ü∫ R√©initialiser</span>
            </button>
        </div>

        <div class="progress-bar" id="progressBar">
            <div class="progress" id="progress"></div>
        </div>

        <div class="status ready" id="status">
            Pr√™t √† convertir le texte en voix
        </div>

        <div class="audio-preview" id="audioPreview">
            <h3>Pr√©visualisation audio :</h3>
            <audio id="audioPlayer" controls></audio>
            <p><small>√âcoutez l'audio g√©n√©r√© avant de le t√©l√©charger</small></p>
        </div>

        <div class="instructions">
            <h3>Instructions d'utilisation</h3>
            <ul>
                <li><strong>√âtape 1 :</strong> Obtenez une cl√© API gratuite sur <a href="https://www.voicerss.org/api/" target="_blank">voicerss.org</a></li>
                <li><strong>√âtape 2 :</strong> Collez votre cl√© API dans le champ ci-dessus</li>
                <li><strong>√âtape 3 :</strong> Saisissez ou collez votre texte √† convertir</li>
                <li><strong>√âtape 4 :</strong> Ajustez les param√®tres audio selon vos pr√©f√©rences</li>
                <li><strong>√âtape 5 :</strong> S√©lectionnez une voix et le format de sortie</li>
                <li><strong>√âtape 6 :</strong> Cliquez sur "G√©n√©rer avec VoiceRSS" pour cr√©er l'audio</li>
                <li><strong>√âtape 7 :</strong> T√©l√©chargez le fichier audio compatible avec tous les lecteurs</li>
            </ul>
        </div>
    </div>

    <footer>
        <p>Application professionnelle avec VoiceRSS - Compatible Windows Media Player, VLC, etc.</p>
    </footer>

    <!-- VoiceRSS SDK -->
    <script src="https://cdn.voicerss.org/vrss.js"></script>

    <script>
        // √âl√©ments DOM
        const textInput = document.getElementById('textInput');
        const charCount = document.getElementById('charCount');
        const wordCount = document.getElementById('wordCount');
        const sentenceCount = document.getElementById('sentenceCount');
        const rateSlider = document.getElementById('rate');
        const rateValue = document.getElementById('rateValue');
        const pitchSlider = document.getElementById('pitch');
        const pitchValue = document.getElementById('pitchValue');
        const volumeSlider = document.getElementById('volume');
        const volumeValue = document.getElementById('volumeValue');
        const voicesContainer = document.getElementById('voicesContainer');
        const voicesLoading = document.getElementById('voicesLoading');
        const playBtn = document.getElementById('playBtn');
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const stopBtn = document.getElementById('stopBtn');
        const resetBtn = document.getElementById('resetBtn');
        const status = document.getElementById('status');
        const loadExample = document.getElementById('loadExample');
        const audioPreview = document.getElementById('audioPreview');
        const audioPlayer = document.getElementById('audioPlayer');
        const progressBar = document.getElementById('progressBar');
        const progress = document.getElementById('progress');
        const voiceRSSKey = document.getElementById('voiceRSSKey');
        const apiMethod = document.getElementById('apiMethod');
        const formatButtons = document.querySelectorAll('.format-btn');
        const qualityButtons = document.querySelectorAll('.quality-btn');

        // Variables globales
        let synth = window.speechSynthesis;
        let voices = [];
        let selectedVoice = null;
        let isPlaying = false;
        let currentUtterance = null;
        let audioBlob = null;
        let audioUrl = null;
        let currentFormat = 'mp3';
        let currentQuality = 'high';
        let voiceRSSVoices = [
            { code: 'fr-fr', name: 'Fran√ßais - Femme', gender: 'female' },
            { code: 'fr-ca', name: 'Fran√ßais Canadien - Femme', gender: 'female' },
            { code: 'en-us', name: 'Anglais US - Femme', gender: 'female' },
            { code: 'en-gb', name: 'Anglais UK - Femme', gender: 'female' },
            { code: 'de-de', name: 'Allemand - Femme', gender: 'female' },
            { code: 'es-es', name: 'Espagnol - Femme', gender: 'female' },
            { code: 'it-it', name: 'Italien - Femme', gender: 'female' },
            { code: 'pt-pt', name: 'Portugais - Femme', gender: 'female' }
        ];

        // Mettre √† jour les statistiques du texte
        function updateTextStats() {
            const text = textInput.value;
            const charCountValue = text.length;
            const wordCountValue = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const sentenceCountValue = sentences.length;
            
            charCount.textContent = `${charCountValue} caract√®res`;
            wordCount.textContent = `${wordCountValue} mots`;
            sentenceCount.textContent = `${sentenceCountValue} phrases`;
        }

        // Mettre √† jour l'affichage des valeurs des sliders
        rateSlider.addEventListener('input', () => {
            rateValue.textContent = rateSlider.value;
        });

        pitchSlider.addEventListener('input', () => {
            pitchValue.textContent = pitchSlider.value;
        });

        volumeSlider.addEventListener('input', () => {
            volumeValue.textContent = volumeSlider.value;
        });

        // G√©rer les formats
        formatButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                formatButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFormat = btn.dataset.format;
            });
        });

        // G√©rer les qualit√©s
        qualityButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                qualityButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentQuality = btn.dataset.quality;
            });
        });

        // Charger les voix disponibles du navigateur
        function loadVoices() {
            voices = synth.getVoices();
            voicesLoading.style.display = 'none';
            voicesContainer.innerHTML = '';
            
            // Filtrer pour obtenir principalement des voix en fran√ßais
            const frenchVoices = voices.filter(voice => 
                voice.lang.startsWith('fr') || 
                voice.name.toLowerCase().includes('french')
            );
            
            const voicesToShow = frenchVoices.length > 0 ? frenchVoices : voices;
            
            if (voicesToShow.length === 0) {
                voicesContainer.innerHTML = '<p>Aucune voix disponible. Votre navigateur peut ne pas supporter la synth√®se vocale.</p>';
                return;
            }
            
            // Ajouter les voix du navigateur
            voicesToShow.forEach((voice, index) => {
                const voiceOption = document.createElement('div');
                voiceOption.className = 'voice-option';
                voiceOption.dataset.type = 'browser';
                if (index === 0) {
                    voiceOption.classList.add('selected');
                    selectedVoice = voice;
                }
                
                voiceOption.innerHTML = `
                    <div class="voice-name">${voice.name}</div>
                    <div class="voice-lang">${voice.lang} - Navigateur</div>
                `;
                
                voiceOption.addEventListener('click', () => {
                    document.querySelectorAll('.voice-option[data-type="browser"]').forEach(option => {
                        option.classList.remove('selected');
                    });
                    voiceOption.classList.add('selected');
                    selectedVoice = voice;
                });
                
                voicesContainer.appendChild(voiceOption);
            });
            
            // Ajouter les voix VoiceRSS
            voiceRSSVoices.forEach((voice, index) => {
                const voiceOption = document.createElement('div');
                voiceOption.className = 'voice-option';
                voiceOption.dataset.type = 'voicerss';
                
                voiceOption.innerHTML = `
                    <div class="voice-name">${voice.name}</div>
                    <div class="voice-lang">${voice.code} - VoiceRSS</div>
                `;
                
                voiceOption.addEventListener('click', () => {
                    document.querySelectorAll('.voice-option[data-type="voicerss"]').forEach(option => {
                        option.classList.remove('selected');
                    });
                    voiceOption.classList.add('selected');
                    selectedVoice = voice;
                });
                
                voicesContainer.appendChild(voiceOption);
            });
        }

        // Initialiser les voix
        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = loadVoices;
        }
        loadVoices();

        // Mettre √† jour les stats du texte
        textInput.addEventListener('input', updateTextStats);
        updateTextStats();

        // Lecture avec la synth√®se vocale du navigateur
        playBtn.addEventListener('click', () => {
            if (isPlaying) {
                synth.cancel();
                isPlaying = false;
                updateButtons();
                return;
            }
            
            const text = textInput.value.trim();
            if (text === '') {
                alert('Veuillez saisir du texte √† lire.');
                return;
            }
            
            if (!selectedVoice || selectedVoice.type === 'voicerss') {
                alert('Veuillez s√©lectionner une voix du navigateur pour la lecture.');
                return;
            }
            
            currentUtterance = new SpeechSynthesisUtterance(text);
            currentUtterance.voice = selectedVoice;
            currentUtterance.rate = parseFloat(rateSlider.value);
            currentUtterance.pitch = parseFloat(pitchSlider.value);
            currentUtterance.volume = parseFloat(volumeSlider.value);
            
            currentUtterance.onstart = () => {
                isPlaying = true;
                updateButtons();
                status.textContent = 'Lecture en cours...';
                status.className = 'status speaking';
            };
            
            currentUtterance.onend = () => {
                isPlaying = false;
                updateButtons();
                status.textContent = 'Lecture termin√©e';
                status.className = 'status ready';
            };
            
            currentUtterance.onerror = () => {
                isPlaying = false;
                updateButtons();
                status.textContent = 'Erreur lors de la lecture';
                status.className = 'status stopped';
            };
            
            synth.speak(currentUtterance);
        });

        // Arr√™ter la lecture
        stopBtn.addEventListener('click', () => {
            synth.cancel();
            isPlaying = false;
            updateButtons();
            status.textContent = 'Lecture arr√™t√©e';
            status.className = 'status stopped';
        });

        // G√©n√©rer avec VoiceRSS
        generateBtn.addEventListener('click', async () => {
            const text = textInput.value.trim();
            if (text === '') {
                alert('Veuillez saisir du texte √† convertir.');
                return;
            }
            
            if (text.length > 5000) {
                alert('Texte trop long. Veuillez le diviser en parties de moins de 5000 caract√®res.');
                return;
            }
            
            const apiKey = voiceRSSKey.value.trim();
            const method = apiMethod.value;
            
            if (method === 'voicerss' || method === 'both') {
                if (!apiKey) {
                    alert('Veuillez entrer votre cl√© API VoiceRSS pour g√©n√©rer l\'audio.');
                    return;
                }
                
                if (apiKey.length < 32) {
                    alert('Cl√© API invalide. Veuillez v√©rifier votre cl√© VoiceRSS.');
                    return;
                }
                
                // V√©rifier si une voix VoiceRSS est s√©lectionn√©e
                const selectedVoiceOption = document.querySelector('.voice-option.selected[data-type="voicerss"]');
                if (!selectedVoiceOption && method === 'voicerss') {
                    alert('Veuillez s√©lectionner une voix VoiceRSS pour g√©n√©rer l\'audio.');
                    return;
                }
            }
            
            // Afficher la progression
            progressBar.style.display = 'block';
            progress.style.width = '10%';
            updateStatus('Initialisation de la g√©n√©ration...', 'processing');
            
            try {
                if (method === 'browser') {
                    // G√©n√©rer avec le navigateur
                    await generateWithBrowser(text);
                } else if (method === 'voicerss') {
                    // G√©n√©rer avec VoiceRSS
                    await generateWithVoiceRSS(text, apiKey);
                } else if (method === 'both') {
                    // G√©n√©rer avec les deux
                    await generateWithBoth(text, apiKey);
                }
                
                // Activer le bouton de t√©l√©chargement
                downloadBtn.disabled = false;
                
                // Finaliser la progression
                progress.style.width = '100%';
                updateStatus('‚úÖ Audio g√©n√©r√© avec succ√®s ! Pr√™t √† t√©l√©charger.', 'success');
                
                // Masquer la barre de progression apr√®s un d√©lai
                setTimeout(() => {
                    progressBar.style.display = 'none';
                }, 2000);
                
            } catch (error) {
                console.error('Erreur:', error);
                updateStatus('‚ùå Erreur lors de la g√©n√©ration audio', 'error');
                progressBar.style.display = 'none';
            }
        });

        // G√©n√©rer avec le navigateur
        async function generateWithBrowser(text) {
            updateStatus('G√©n√©ration avec la synth√®se vocale du navigateur...', 'processing');
            
            // Simuler la g√©n√©ration
            await simulateProgress(20, 50, 'Pr√©paration de la synth√®se...');
            
            // Cr√©er un fichier audio simul√©
            const audioContent = generateSimulatedAudio(text);
            const mimeType = getMimeType(currentFormat);
            
            audioBlob = new Blob([audioContent], { type: mimeType });
            
            if (audioUrl) URL.revokeObjectURL(audioUrl);
            audioUrl = URL.createObjectURL(audioBlob);
            
            // Configurer le lecteur audio
            audioPlayer.src = audioUrl;
            audioPreview.style.display = 'block';
            
            await simulateProgress(50, 80, 'Finalisation du fichier...');
        }

        // G√©n√©rer avec VoiceRSS
        async function generateWithVoiceRSS(text, apiKey) {
            updateStatus('Connexion √† VoiceRSS...', 'processing');
            
            // Obtenir la voix s√©lectionn√©e
            const selectedVoiceOption = document.querySelector('.voice-option.selected[data-type="voicerss"]');
            const voiceCode = selectedVoiceOption ? 
                selectedVoiceOption.querySelector('.voice-lang').textContent.split(' - ')[0] : 
                'fr-fr';
            
            // Param√®tres VoiceRSS
            const params = {
                key: apiKey,
                src: text,
                hl: voiceCode,
                v: getVoiceRSSVoice(voiceCode),
                r: convertRateToVoiceRSS(parseFloat(rateSlider.value)),
                c: getAudioCodec(currentFormat),
                f: getAudioFormat(currentQuality, currentFormat),
                ssml: 'false',
                b64: 'true'
            };
            
            await simulateProgress(20, 40, 'Envoi du texte √† VoiceRSS...');
            
            // Construire l'URL VoiceRSS
            const queryString = Object.keys(params)
                .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
                .join('&');
            
            const voiceRSSUrl = `https://api.voicerss.org/?${queryString}`;
            
            await simulateProgress(40, 60, 'G√©n√©ration de l\'audio...');
            
            try {
                // Appeler l'API VoiceRSS
                const response = await fetch(voiceRSSUrl);
                
                if (!response.ok) {
                    throw new Error(`Erreur VoiceRSS: ${response.status}`);
                }
                
                const audioData = await response.text();
                
                await simulateProgress(60, 80, 'Traitement des donn√©es audio...');
                
                // V√©rifier si c'est une erreur (VoiceRSS renvoie du texte en cas d'erreur)
                if (audioData.startsWith('ERROR')) {
                    throw new Error(`VoiceRSS: ${audioData}`);
                }
                
                // Convertir base64 en blob
                const mimeType = getMimeType(currentFormat);
                const byteCharacters = atob(audioData);
                const byteNumbers = new Array(byteCharacters.length);
                
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                
                const byteArray = new Uint8Array(byteNumbers);
                audioBlob = new Blob([byteArray], { type: mimeType });
                
                if (audioUrl) URL.revokeObjectURL(audioUrl);
                audioUrl = URL.createObjectURL(audioBlob);
                
                // Configurer le lecteur audio
                audioPlayer.src = audioUrl;
                audioPreview.style.display = 'block';
                
            } catch (error) {
                console.error('Erreur VoiceRSS:', error);
                throw error;
            }
        }

        // G√©n√©rer avec les deux m√©thodes
        async function generateWithBoth(text, apiKey) {
            updateStatus('Lecture avec navigateur...', 'processing');
            
            // Lire avec le navigateur
            const utterance = new SpeechSynthesisUtterance(text);
            if (selectedVoice && selectedVoice.type !== 'voicerss') {
                utterance.voice = selectedVoice;
            }
            utterance.rate = parseFloat(rateSlider.value);
            utterance.pitch = parseFloat(pitchSlider.value);
            utterance.volume = parseFloat(volumeSlider.value);
            
            synth.speak(utterance);
            
            // G√©n√©rer avec VoiceRSS
            await generateWithVoiceRSS(text, apiKey);
        }

        // Simuler la progression
        async function simulateProgress(start, end, message) {
            return new Promise(resolve => {
                let progressValue = start;
                const interval = setInterval(() => {
                    progressValue += 2;
                    progress.style.width = `${progressValue}%`;
                    
                    if (progressValue % 20 === 0) {
                        updateStatus(message, 'processing');
                    }
                    
                    if (progressValue >= end) {
                        clearInterval(interval);
                        resolve();
                    }
                }, 50);
            });
        }

        // T√©l√©charger l'audio
        downloadBtn.addEventListener('click', () => {
            if (!audioBlob) {
                alert('Veuillez d\'abord g√©n√©rer un fichier audio.');
                return;
            }
            
            // Cr√©er un nom de fichier
            const date = new Date();
            const timestamp = `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}_${date.getHours()}${date.getMinutes()}`;
            const textPreview = textInput.value.substring(0, 30).replace(/[^a-z0-9]/gi, '_').toLowerCase();
            const filename = `audio_${textPreview}_${timestamp}.${currentFormat}`;
            
            // Cr√©er un lien de t√©l√©chargement
            const link = document.createElement('a');
            link.href = audioUrl;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            updateStatus(`‚úÖ Fichier t√©l√©charg√©: ${filename}`, 'success');
            
            // Instructions de compatibilit√©
            setTimeout(() => {
                showCompatibilityInstructions(filename);
            }, 500);
        });

        // R√©initialiser
        resetBtn.addEventListener('click', () => {
            synth.cancel();
            isPlaying = false;
            
            // R√©initialiser les sliders
            rateSlider.value = 1;
            rateValue.textContent = '1.0';
            pitchSlider.value = 1;
            pitchValue.textContent = '1.0';
            volumeSlider.value = 1;
            volumeValue.textContent = '1.0';
            
            // R√©initialiser le texte
            textInput.value = '';
            updateTextStats();
            
            // R√©initialiser l'audio
            if (audioUrl) {
                URL.revokeObjectURL(audioUrl);
                audioUrl = null;
                audioBlob = null;
            }
            
            audioPreview.style.display = 'none';
            downloadBtn.disabled = true;
            progressBar.style.display = 'none';
            
            updateButtons();
            updateStatus('Pr√™t √† convertir le texte en voix', 'ready');
        });

        // Charger un exemple
        loadExample.addEventListener('click', () => {
            textInput.value = `La technologie VoiceRSS offre une qualit√© audio exceptionnelle pour la synth√®se vocale.

Avantages de VoiceRSS :
1. Voix naturelles et expressives
2. Support de plus de 30 langues
3. Conversion rapide et fiable
4. Fichiers audio compatibles avec tous les lecteurs

Pour obtenir une cl√© API gratuite :
- Visitez https://www.voicerss.org/api/
- Inscrivez-vous gratuitement
- Obtenez 300 requ√™tes par jour
- Collez votre cl√© dans le champ pr√©vu

Essayez maintenant avec votre propre texte !`;
            updateTextStats();
        });

        // Mettre √† jour l'√©tat des boutons
        function updateButtons() {
            playBtn.innerHTML = isPlaying ? 
                '<span>‚èπ Arr√™ter la lecture</span>' : 
                '<span>‚ñ∂ √âcouter (Navigateur)</span>';
            stopBtn.disabled = !isPlaying;
        }

        // Mettre √† jour le statut
        function updateStatus(message, type = '') {
            status.textContent = message;
            status.className = 'status';
            if (type) status.classList.add(type);
        }

        // Fonctions utilitaires
        function getMimeType(format) {
            switch (format) {
                case 'mp3': return 'audio/mpeg';
                case 'wav': return 'audio/wav';
                case 'ogg': return 'audio/ogg';
                default: return 'audio/mpeg';
            }
        }

        function getVoiceRSSVoice(languageCode) {
            // Mapping des voix VoiceRSS
            const voices = {
                'fr-fr': 'Alice',
                'fr-ca': 'Chantal',
                'en-us': 'Linda',
                'en-gb': 'Amy',
                'de-de': 'Vicki',
                'es-es': 'Enrique',
                'it-it': 'Paola',
                'pt-pt': 'Cristiano'
            };
            return voices[languageCode] || 'Alice';
        }

        function convertRateToVoiceRSS(rate) {
            // Convertir de 0.5-2 √† -10 √† 10
            return Math.round((rate - 0.5) * (20/1.5) - 10);
        }

        function getAudioCodec(format) {
            return format === 'mp3' ? 'MP3' : format === 'wav' ? 'WAV' : 'OGG';
        }

        function getAudioFormat(quality, format) {
            if (format === 'wav') {
                return quality === 'high' ? '44khz_16bit_stereo' : 
                       quality === 'medium' ? '32khz_16bit_mono' : '16khz_16bit_mono';
            } else if (format === 'mp3') {
                return quality === 'high' ? '44khz_128kbit' : 
                       quality === 'medium' ? '32khz_64kbit' : '16khz_32kbit';
            } else {
                return quality === 'high' ? '44khz_64kbit' : 
                       quality === 'medium' ? '32khz_48kbit' : '16khz_32kbit';
            }
        }

        function generateSimulatedAudio(text) {
            // Simuler des donn√©es audio pour la version navigateur
            const audioData = `Fichier audio simul√©: ${text.substring(0, 100)}...`;
            return audioData;
        }

        function showCompatibilityInstructions(filename) {
            const formatUpper = currentFormat.toUpperCase();
            alert(`‚úÖ Fichier ${formatUpper} t√©l√©charg√© avec succ√®s !

üìÅ Nom: ${filename}
üéµ Format: ${formatUpper}
üìÇ Emplacement: Votre dossier de t√©l√©chargements

Pour une compatibilit√© 100% garantie :

1. Si probl√®me avec Windows Media Player :
   ‚Ä¢ T√©l√©chargez VLC Media Player (gratuit)
   ‚Ä¢ VLC lit TOUS les formats audio
   ‚Ä¢ Ou convertissez en WAV (plus compatible)

2. Conversion gratuite en ligne :
   ‚Ä¢ Allez sur https://online-audio-converter.com
   ‚Ä¢ T√©l√©versez votre fichier
   ‚Ä¢ Convertissez en MP3 128kbps ou WAV
   ‚Ä¢ Windows Media Player lira parfaitement

3. Pour votre t√©l√©phone :
   ‚Ä¢ Envoyez le fichier par email
   ‚Ä¢ Ou transf√©rez par c√¢ble USB
   ‚Ä¢ Tous les smartphones lisent les MP3/WAV`);
        }

        // Initialiser
        updateButtons();
    </script>
</body>
</html>
