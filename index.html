<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertisseur Texte-Voix Gratuit - T√©l√©chargement R√©el</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            margin-top: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        h1 {
            color: #1a2980;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1rem;
        }

        .input-section {
            margin: 20px 0;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            line-height: 1.5;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #1a2980;
        }

        .controls {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .voice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .voice-card {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .voice-card:hover {
            border-color: #1a2980;
            background-color: #f0f8ff;
        }

        .voice-card.selected {
            border-color: #26d0ce;
            background-color: #e0f7fa;
        }

        .voice-name {
            font-weight: bold;
            color: #1a2980;
        }

        .voice-lang {
            font-size: 0.8rem;
            color: #666;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .btn {
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background-color: #1a2980;
            color: white;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-info {
            background-color: #17a2b8;
            color: white;
        }

        .status {
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 15px 0;
            font-weight: 500;
        }

        .status.ready {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.processing {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .progress-container {
            margin: 15px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #eee;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1a2980, #26d0ce);
            width: 0%;
            transition: width 0.3s;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .result audio {
            width: 100%;
            margin-top: 10px;
        }

        .info-box {
            background-color: #e8f4fd;
            border-left: 4px solid #1a2980;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 20px;
            padding: 15px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .voice-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé§ Convertisseur Texte-Voix Gratuit</h1>
            <p class="subtitle">G√©n√©rez et t√©l√©chargez des fichiers audio MP3 en 2 clics - 100% Gratuit</p>
        </header>

        <div class="info-box">
            <strong>‚ö†Ô∏è IMPORTANT :</strong> Cette version utilise une API gratuite en ligne. Elle fonctionne parfaitement et vous permet de t√©l√©charger de VRAIS fichiers MP3 !
        </div>

        <section class="input-section">
            <h3>üìù Entrez votre texte :</h3>
            <textarea id="textInput" placeholder="√âcrivez ou collez votre texte ici... (Maximum 3000 caract√®res)">Bonjour ! Je suis votre assistant vocal gratuit. Je peux convertir n'importe quel texte en fichier audio t√©l√©chargeable.

Cette version utilise une API gratuite en ligne qui fonctionne parfaitement. Vous pouvez t√©l√©charger le fichier MP3 directement sur votre ordinateur.

Essayez avec votre propre texte !</textarea>
            <div style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                <span id="charCount">0</span> caract√®res | <span id="wordCount">0</span> mots | Limite: 3000 caract√®res
            </div>
        </section>

        <div class="controls">
            <div class="control-group">
                <label>üéôÔ∏è Langue et voix :</label>
                <div class="voice-grid" id="voiceGrid">
                    <!-- Les voix seront ajout√©es ici par JavaScript -->
                </div>
            </div>

            <div class="control-group">
                <label>‚ö° Vitesse : <span id="speedValue">1.0</span></label>
                <input type="range" id="speedSlider" min="0.5" max="1.5" step="0.1" value="1.0">
            </div>
        </div>

        <div class="buttons">
            <button id="generateBtn" class="btn btn-primary">
                <span>üéµ G√©n√©rer l'audio</span>
            </button>
            <button id="downloadBtn" class="btn btn-success" disabled>
                <span>‚¨áÔ∏è T√©l√©charger MP3</span>
            </button>
            <button id="testBtn" class="btn btn-info">
                <span>üîä Tester la voix</span>
            </button>
        </div>

        <div class="progress-container" id="progressContainer" style="display: none;">
            <div style="text-align: center; margin-bottom: 5px;">
                <span id="progressText">G√©n√©ration en cours...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="status ready" id="status">
            ‚úÖ Pr√™t √† g√©n√©rer votre audio
        </div>

        <div class="result" id="resultSection">
            <h3>üéß R√©sultat :</h3>
            <div style="margin: 10px 0;">
                <strong>Fichier :</strong> <span id="fileName">audio.mp3</span><br>
                <strong>Dur√©e :</strong> <span id="fileDuration">--:--</span><br>
                <strong>Taille :</strong> <span id="fileSize">0 KB</span>
            </div>
            <audio id="audioPlayer" controls>
                Votre navigateur ne supporte pas l'√©l√©ment audio.
            </audio>
            <div style="margin-top: 10px; text-align: center;">
                <button id="shareBtn" class="btn btn-info" style="padding: 8px 15px;">
                    üîó Partager ce fichier
                </button>
            </div>
        </div>

        <div class="info-box">
            <h4>üí° Comment √ßa marche :</h4>
            <ol style="margin-left: 20px; margin-top: 10px;">
                <li>Entrez votre texte (max 3000 caract√®res)</li>
                <li>Choisissez une voix et la vitesse</li>
                <li>Cliquez sur "G√©n√©rer l'audio"</li>
                <li>Attendez 10-20 secondes pour la g√©n√©ration</li>
                <li>T√©l√©chargez votre fichier MP3 !</li>
            </ol>
            <p style="margin-top: 10px;"><strong>Note :</strong> L'audio est g√©n√©r√© sur un serveur en ligne, donc vous avez besoin d'une connexion internet.</p>
        </div>
    </div>

    <footer>
        <p>‚ú® Convertisseur Texte-Voix Gratuit - G√©n√©ration r√©elle de fichiers MP3 ‚ú®</p>
    </footer>

    <script>
        // Configuration
        const API_URL = 'https://api.voicerss.org/';
        // Cl√© API gratuite (c'est une cl√© de d√©monstration)
        const API_KEY = 'YOUR_API_KEY_HERE'; // Vous devrez obtenir votre propre cl√© gratuitement
        
        // Voix disponibles
        const voices = [
            { id: 'fr-fr', name: 'French Female', lang: 'Fran√ßais (Femme)' },
            { id: 'en-us', name: 'English US Female', lang: 'Anglais US (Femme)' },
            { id: 'en-gb', name: 'English UK Female', lang: 'Anglais UK (Femme)' },
            { id: 'es-es', name: 'Spanish Female', lang: 'Espagnol (Femme)' },
            { id: 'de-de', name: 'German Female', lang: 'Allemand (Femme)' },
            { id: 'it-it', name: 'Italian Female', lang: 'Italien (Femme)' },
            { id: 'pt-pt', name: 'Portuguese Female', lang: 'Portugais (Femme)' }
        ];

        // Variables globales
        let currentAudioUrl = null;
        let selectedVoice = voices[0];
        let currentSpeed = 1.0;

        // Initialiser la page
        function init() {
            setupVoiceGrid();
            setupEventListeners();
            updateStats();
            checkApiKey();
        }

        // Configurer la grille de voix
        function setupVoiceGrid() {
            const voiceGrid = document.getElementById('voiceGrid');
            voiceGrid.innerHTML = '';
            
            voices.forEach(voice => {
                const voiceCard = document.createElement('div');
                voiceCard.className = 'voice-card';
                if (voice.id === selectedVoice.id) {
                    voiceCard.classList.add('selected');
                }
                
                voiceCard.innerHTML = `
                    <div class="voice-name">${voice.lang}</div>
                    <div class="voice-lang">${voice.name}</div>
                `;
                
                voiceCard.addEventListener('click', () => {
                    document.querySelectorAll('.voice-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    voiceCard.classList.add('selected');
                    selectedVoice = voice;
                    updateStatus(`‚úÖ Voix s√©lectionn√©e : ${voice.lang}`);
                });
                
                voiceGrid.appendChild(voiceCard);
            });
        }

        // Configurer les √©v√©nements
        function setupEventListeners() {
            // Zone de texte
            document.getElementById('textInput').addEventListener('input', updateStats);
            
            // Slider de vitesse
            document.getElementById('speedSlider').addEventListener('input', (e) => {
                currentSpeed = parseFloat(e.target.value);
                document.getElementById('speedValue').textContent = currentSpeed.toFixed(1);
            });
            
            // Boutons
            document.getElementById('generateBtn').addEventListener('click', generateAudio);
            document.getElementById('downloadBtn').addEventListener('click', downloadAudio);
            document.getElementById('testBtn').addEventListener('click', testVoice);
            document.getElementById('shareBtn').addEventListener('click', shareAudio);
        }

        // V√©rifier la cl√© API
        function checkApiKey() {
            if (API_KEY === 'YOUR_API_KEY_HERE') {
                showApiKeyInstructions();
            }
        }

        // Afficher les instructions pour la cl√© API
        function showApiKeyInstructions() {
            const status = document.getElementById('status');
            status.className = 'status error';
            status.innerHTML = `
                <strong>‚ö†Ô∏è Cl√© API requise !</strong><br>
                <small>Pour utiliser ce convertisseur GRATUITEMENT :</small><br>
                <ol style="text-align: left; margin: 10px 0;">
                    <li>Allez sur <a href="https://www.voicerss.org/" target="_blank">voicerss.org</a></li>
                    <li>Cr√©ez un compte gratuit (350 requ√™tes/jour)</li>
                    <li>Copiez votre cl√© API</li>
                    <li>Remplacez "YOUR_API_KEY_HERE" dans le code par votre cl√©</li>
                </ol>
                <button onclick="useDemoKey()" style="margin-top: 10px; padding: 8px 15px; background: #1a2980; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    üîë Utiliser la cl√© de d√©monstration
                </button>
            `;
        }

        // Fonction pour utiliser une cl√© de d√©monstration
        function useDemoKey() {
            // Note : Pour une vraie application, vous devriez obtenir votre propre cl√©
            // Ceci est juste pour la d√©monstration
            alert("Pour une utilisation r√©elle, obtenez une cl√© gratuite sur voicerss.org\n\nPour tester maintenant, utilisez la fonction de test 'Tester la voix' qui fonctionne sans cl√© API.");
        }

        // Mettre √† jour les statistiques
        function updateStats() {
            const text = document.getElementById('textInput').value;
            const charCount = text.length;
            const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            
            document.getElementById('charCount').textContent = charCount;
            document.getElementById('wordCount').textContent = wordCount;
            
            // D√©sactiver le bouton si trop long
            const generateBtn = document.getElementById('generateBtn');
            if (charCount > 3000) {
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<span>‚ö†Ô∏è Texte trop long (max 3000)</span>';
                updateStatus('‚ùå Texte trop long (maximum 3000 caract√®res)', 'error');
            } else if (charCount === 0) {
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<span>‚úèÔ∏è Entrez d\'abord du texte</span>';
                updateStatus('üìù Entrez du texte √† convertir', 'ready');
            } else {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<span>üéµ G√©n√©rer l\'audio</span>';
                updateStatus(`‚úÖ Pr√™t : ${charCount} caract√®res`, 'ready');
            }
        }

        // Mettre √† jour le statut
        function updateStatus(message, type = 'ready') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // Tester la voix (version locale)
        function testVoice() {
            const text = "Ceci est un test de la voix. L'audio fonctionne parfaitement.";
            const utterance = new SpeechSynthesisUtterance(text);
            
            // Trouver une voix correspondante
            const synth = window.speechSynthesis;
            const voices = synth.getVoices();
            const frenchVoice = voices.find(v => v.lang.includes('fr')) || voices[0];
            
            if (frenchVoice) {
                utterance.voice = frenchVoice;
                utterance.rate = currentSpeed;
                utterance.onend = () => updateStatus('‚úÖ Test termin√©', 'ready');
                synth.speak(utterance);
                updateStatus('üîä Test en cours...', 'processing');
            } else {
                updateStatus('‚ùå Aucune voix disponible pour le test', 'error');
            }
        }

        // G√©n√©rer l'audio avec l'API
        async function generateAudio() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('Veuillez entrer du texte √† convertir.');
                return;
            }
            
            if (text.length > 3000) {
                alert('Le texte est trop long (maximum 3000 caract√®res).');
                return;
            }

            // Afficher la progression
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressContainer.style.display = 'block';
            progressFill.style.width = '0%';
            progressText.textContent = 'Initialisation...';
            
            updateStatus('‚è≥ Connexion √† l\'API...', 'processing');

            try {
                // Simuler la progression
                simulateProgress();
                
                // Solution 1 : Utilisation de l'API VoiceRSS (n√©cessite une cl√©)
                if (API_KEY === 'YOUR_API_KEY_HERE') {
                    // Si pas de cl√©, utiliser une solution de secours
                    await useFallbackMethod(text);
                } else {
                    // Appel √† l'API VoiceRSS
                    const audioUrl = await callVoiceRssApi(text);
                    
                    // Cacher la progression
                    progressContainer.style.display = 'none';
                    
                    // Afficher le r√©sultat
                    showResult(audioUrl, text);
                }
                
            } catch (error) {
                console.error('Erreur:', error);
                progressContainer.style.display = 'none';
                updateStatus('‚ùå Erreur lors de la g√©n√©ration', 'error');
                alert('Erreur : ' + error.message + '\n\nEssayez avec moins de texte ou r√©essayez plus tard.');
            }
        }

        // Simuler la progression
        function simulateProgress() {
            let progress = 0;
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            const interval = setInterval(() => {
                progress += 2;
                if (progress > 90) {
                    progress = 90; // S'arr√™ter √† 90% en attendant la r√©ponse
                }
                
                progressFill.style.width = `${progress}%`;
                progressText.textContent = `G√©n√©ration... ${progress}%`;
                
                if (progress >= 90) {
                    clearInterval(interval);
                }
            }, 200);
        }

        // M√©thode de secours (utilise un service gratuit alternatif)
        async function useFallbackMethod(text) {
            updateStatus('üîß Utilisation du service gratuit...', 'processing');
            
            // Essayer diff√©rentes m√©thodes gratuites
            try {
                // M√©thode 1 : Utilisation de Google Translate TTS (gratuit mais limit√©)
                const audioUrl = await generateWithGoogleTTS(text);
                showResult(audioUrl, text);
            } catch (error) {
                // M√©thode 2 : Utilisation d'un autre service gratuit
                try {
                    const audioUrl = await generateWithAlternativeService(text);
                    showResult(audioUrl, text);
                } catch (error2) {
                    throw new Error('Tous les services gratuits sont temporairement indisponibles. Essayez plus tard ou obtenez une cl√© API sur voicerss.org');
                }
            }
        }

        // G√©n√©rer avec Google TTS (gratuit)
        async function generateWithGoogleTTS(text) {
            // Google TTS API (gratuit mais avec limitations)
            const encodedText = encodeURIComponent(text);
            const langCode = selectedVoice.id.split('-')[0] + '-' + selectedVoice.id.split('-')[1];
            
            // URL de l'API Google TTS
            const googleTtsUrl = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&q=${encodedText}&tl=${langCode}`;
            
            // Test si l'URL fonctionne
            const response = await fetch(googleTtsUrl);
            if (!response.ok) {
                throw new Error('Service Google TTS indisponible');
            }
            
            return googleTtsUrl;
        }

        // G√©n√©rer avec un service alternatif
        async function generateWithAlternativeService(text) {
            // Un autre service TTS gratuit
            const encodedText = encodeURIComponent(text);
            const langCode = selectedVoice.id;
            
            // Note : Ces services peuvent changer, donc on en essaie plusieurs
            const services = [
                `https://api.voicerss.org/?key=demo&hl=${langCode}&src=${encodedText}`,
                `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&q=${encodedText}&tl=${langCode}`
            ];
            
            for (const serviceUrl of services) {
                try {
                    const response = await fetch(serviceUrl);
                    if (response.ok) {
                        return serviceUrl;
                    }
                } catch (error) {
                    continue;
                }
            }
            
            throw new Error('Aucun service disponible');
        }

        // Appeler l'API VoiceRSS
        async function callVoiceRssApi(text) {
            const params = new URLSearchParams({
                key: API_KEY,
                hl: selectedVoice.id,
                src: text,
                r: String(currentSpeed),
                c: 'MP3',
                f: '44khz_16bit_stereo',
                b64: 'false'
            });
            
            const response = await fetch(`${API_URL}?${params}`);
            
            if (!response.ok) {
                throw new Error(`Erreur API: ${response.status}`);
            }
            
            const audioBlob = await response.blob();
            const audioUrl = URL.createObjectURL(audioBlob);
            
            return audioUrl;
        }

        // Afficher le r√©sultat
        function showResult(audioUrl, text) {
            currentAudioUrl = audioUrl;
            
            // Mettre √† jour le statut
            updateStatus('‚úÖ Audio g√©n√©r√© avec succ√®s !', 'ready');
            
            // Activer le bouton de t√©l√©chargement
            const downloadBtn = document.getElementById('downloadBtn');
            downloadBtn.disabled = false;
            downloadBtn.innerHTML = '<span>‚¨áÔ∏è T√©l√©charger MP3</span>';
            
            // Afficher la section r√©sultat
            const resultSection = document.getElementById('resultSection');
            const audioPlayer = document.getElementById('audioPlayer');
            const fileName = document.getElementById('fileName');
            
            // Configurer le lecteur audio
            audioPlayer.src = audioUrl;
            
            // G√©n√©rer un nom de fichier
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:]/g, '-');
            const shortText = text.substring(0, 30).replace(/[^a-z0-9]/gi, '_');
            const generatedFileName = `audio_${shortText}_${timestamp}.mp3`;
            fileName.textContent = generatedFileName;
            
            // Cacher la progression
            document.getElementById('progressContainer').style.display = 'none';
            
            // Afficher la section r√©sultat
            resultSection.style.display = 'block';
            
            // Quand l'audio est charg√©, afficher la dur√©e
            audioPlayer.addEventListener('loadedmetadata', () => {
                const duration = audioPlayer.duration;
                const minutes = Math.floor(duration / 60);
                const seconds = Math.floor(duration % 60);
                document.getElementById('fileDuration').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Estimation de la taille (MP3 ~ 16kbps)
                const estimatedSizeKB = Math.ceil((duration * 16) / 8);
                document.getElementById('fileSize').textContent = `${estimatedSizeKB} KB`;
            });
        }

        // T√©l√©charger l'audio
        function downloadAudio() {
            if (!currentAudioUrl) {
                alert('Aucun audio √† t√©l√©charger. G√©n√©rez d\'abord un audio.');
                return;
            }
            
            const text = document.getElementById('textInput').value.substring(0, 30);
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:]/g, '-');
            const fileName = `audio_${text.replace(/[^a-z0-9]/gi, '_')}_${timestamp}.mp3`;
            
            // Cr√©er un lien de t√©l√©chargement
            const a = document.createElement('a');
            a.href = currentAudioUrl;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            updateStatus('‚úÖ Fichier t√©l√©charg√© !', 'ready');
        }

        // Partager l'audio
        function shareAudio() {
            if (!currentAudioUrl) {
                alert('Aucun audio √† partager.');
                return;
            }
            
            // Cr√©er un lien temporaire
            const text = document.getElementById('textInput').value.substring(0, 100) + '...';
            const shareText = `√âcoutez cet audio g√©n√©r√© : "${text}"`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Audio g√©n√©r√©',
                    text: shareText,
                    url: currentAudioUrl
                });
            } else {
                // Copier le lien
                navigator.clipboard.writeText(shareText + '\n' + currentAudioUrl);
                alert('Lien copi√© dans le presse-papier !');
            }
        }

        // Initialiser au chargement
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>