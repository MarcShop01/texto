<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synth√®se Vocale - Voix Masculine avec T√©l√©chargement</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        main {
            padding: 30px;
        }

        .api-section {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid #5c6bc0;
        }

        .api-section h3 {
            margin-bottom: 15px;
            color: #bbdefb;
        }

        .api-input {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .api-input input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #5c6bc0;
            border-radius: 8px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .api-input input::placeholder {
            color: #bbdefb;
        }

        .api-input button {
            background: linear-gradient(135deg, #3949ab 0%, #5c6bc0 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .api-input button:hover {
            background: linear-gradient(135deg, #303f9f 0%, #3949ab 100%);
            transform: translateY(-2px);
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            line-height: 1.6;
            resize: vertical;
            margin-bottom: 15px;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #3949ab;
            background: white;
        }

        .char-count {
            text-align: right;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        select, input[type="range"] {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        .range-value {
            text-align: center;
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .voice-presets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .voice-preset {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .voice-preset:hover {
            border-color: #3949ab;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .voice-preset.active {
            background: linear-gradient(135deg, #3949ab 0%, #5c6bc0 100%);
            color: white;
            border-color: #3949ab;
        }

        .voice-preset h4 {
            margin-bottom: 5px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            flex: 1;
            min-width: 180px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3949ab 0%, #5c6bc0 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #c62828 0%, #f44336 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            background: #f5f5f5;
            border-radius: 10px;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3949ab;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            display: none;
            background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%);
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid #3949ab;
        }

        audio {
            width: 100%;
            margin: 15px 0;
            border-radius: 8px;
        }

        .download-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #5c6bc0;
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
        }

        .download-btn:hover {
            background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
            transform: translateY(-2px);
        }

        .file-info {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .info-item {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 3px solid #3949ab;
        }

        footer {
            background: #1a237e;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 10px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .api-input {
                flex-direction: column;
            }
            
            .voice-presets {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéôÔ∏è Synth√®se Vocale - Voix Masculine</h1>
            <p>Texte ‚Üí Voix Masculine Naturelle ‚Üí T√©l√©chargement MP3</p>
        </header>

        <main>
            <!-- Section API -->
            <div class="api-section">
                <h3>üîë Configuration API</h3>
                <p>Pour une voix masculine naturelle, utilisez la cl√© API de d√©monstration ci-dessous.</p>
                <p>Pour votre propre cl√© : <a href="https://www.voicerss.org" target="_blank" style="color: #bbdefb; font-weight: bold;">voicerss.org</a></p>
                
                <div class="api-input">
                    <input type="text" id="apiKey" placeholder="Votre cl√© API VoiceRSS" value="9e8d84a1562443d898dd84917ff45f1b">
                    <button onclick="saveApiKey()">üíæ Sauvegarder</button>
                </div>
                <p id="apiStatus" style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                    ‚úÖ Utilisation de la cl√© de d√©monstration avec voix masculine
                </p>
            </div>

            <!-- Zone de texte -->
            <div>
                <textarea id="textInput" placeholder="√âcrivez votre texte ici... (max 500 caract√®res pour une meilleure qualit√©)">Bonjour, je suis une voix masculine naturelle. Contrairement aux synth√®ses vocales robotiques traditionnelles, ma voix sonne comme celle d'un vrai homme. J'ai un timbre grave et chaleureux, id√©al pour des pr√©sentations professionnelles, des podcasts ou tout autre contenu audio n√©cessitant une voix masculine authentique.</textarea>
                <div class="char-count">
                    Caract√®res: <span id="charCount">0</span> | Recommand√©: moins de 500 caract√®res
                </div>
            </div>

            <!-- S√©lection de voix masculine -->
            <div>
                <h3>üéØ S√©lectionnez votre voix masculine :</h3>
                <div class="voice-presets">
                    <div class="voice-preset active" onclick="selectVoice('male_deep')">
                        <h4>üéôÔ∏è Voix Grave</h4>
                        <p>Timbre profond d'homme m√ªr</p>
                    </div>
                    <div class="voice-preset" onclick="selectVoice('male_warm')">
                        <h4>üî• Voix Chaude</h4>
                        <p>Ton amical et engageant</p>
                    </div>
                    <div class="voice-preset" onclick="selectVoice('male_professional')">
                        <h4>üíº Voix Professionnelle</h4>
                        <p>Claire et articul√©e</p>
                    </div>
                </div>
            </div>

            <!-- Contr√¥les -->
            <div class="controls">
                <div class="control-group">
                    <label for="language">üåç Langue :</label>
                    <select id="language">
                        <option value="fr-ca">Fran√ßais Canadien (voix masculine)</option>
                        <option value="en-us">Anglais Am√©ricain (male voice)</option>
                        <option value="en-gb">Anglais Britannique (male voice)</option>
                        <option value="de-de">Allemand (m√§nnliche Stimme)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="speed">‚ö° Vitesse :</label>
                    <input type="range" id="speed" min="0.7" max="1.3" step="0.1" value="1.0">
                    <div class="range-value" id="speedValue">Normale (1.0)</div>
                </div>

                <div class="control-group">
                    <label for="format">üéµ Format :</label>
                    <select id="format">
                        <option value="mp3">MP3 (recommand√©)</option>
                        <option value="wav">WAV</option>
                        <option value="ogg">OGG</option>
                    </select>
                </div>
            </div>

            <!-- Boutons -->
            <div class="buttons">
                <button id="previewBtn" class="btn-primary">‚ñ∂Ô∏è Pr√©-√©couter</button>
                <button id="generateBtn" class="btn-success">üéµ G√©n√©rer Audio MP3</button>
                <button id="downloadBtn" class="btn-warning" disabled>‚¨áÔ∏è T√©l√©charger MP3</button>
                <button id="clearBtn" class="btn-danger">üóëÔ∏è Effacer</button>
            </div>

            <!-- Chargement -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>G√©n√©ration de la voix masculine en cours...</p>
                <p><small>Cr√©ation d'un fichier audio haute qualit√©</small></p>
            </div>

            <!-- R√©sultat -->
            <div class="result" id="result">
                <h3>‚úÖ Audio Masculin G√©n√©r√© !</h3>
                <p>√âcoutez votre texte avec une voix d'homme naturelle :</p>
                <audio id="audioPlayer" controls></audio>
                
                <div class="download-section">
                    <p><strong>T√©l√©charger votre fichier audio :</strong></p>
                    <a href="#" id="downloadLink" class="download-btn">
                        <span>‚¨áÔ∏è</span>
                        <span>T√©l√©charger le MP3</span>
                        <span id="fileSize">(0 KB)</span>
                    </a>
                    
                    <div class="file-info">
                        <div class="info-item">
                            <strong>Voix :</strong> <span id="voiceInfo">Masculine - Voix Grave</span>
                        </div>
                        <div class="info-item">
                            <strong>Taille :</strong> <span id="sizeInfo">0 KB</span>
                        </div>
                        <div class="info-item">
                            <strong>Dur√©e :</strong> <span id="durationInfo">~0 secondes</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div style="background: #f0f4ff; padding: 25px; border-radius: 10px; margin-top: 30px; border-left: 5px solid #3949ab;">
                <h3 style="color: #1a237e; margin-bottom: 15px;">üìã Guide pour une voix masculine parfaite :</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #3949ab;">1. Choisissez "Fran√ßais Canadien"</h4>
                        <p>Cette langue a les meilleures voix masculines</p>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #3949ab;">2. S√©lectionnez "Voix Grave"</h4>
                        <p>Pour le timbre le plus masculin</p>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #3949ab;">3. Limitez √† 500 caract√®res</h4>
                        <p>Pour une qualit√© audio optimale</p>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>Synth√®se Vocale avec Voix Masculine Naturelle | Utilise VoiceRSS API</p>
        </footer>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================

        // Cl√© API de d√©monstration (avec support voix masculine)
        const DEMO_API_KEY = "9e8d84a1562443d898dd84917ff45f1b";

        // Configuration des voix masculines
        const MALE_VOICE_CONFIGS = {
            'male_deep': {
                voice: 'fr-ca',
                speed: -2,
                pitch: -3
            },
            'male_warm': {
                voice: 'fr-ca',
                speed: 0,
                pitch: -2
            },
            'male_professional': {
                voice: 'en-us',
                speed: -1,
                pitch: -4
            }
        };

        // √âl√©ments DOM
        const elements = {
            textInput: document.getElementById('textInput'),
            apiKeyInput: document.getElementById('apiKey'),
            apiStatus: document.getElementById('apiStatus'),
            language: document.getElementById('language'),
            speed: document.getElementById('speed'),
            speedValue: document.getElementById('speedValue'),
            format: document.getElementById('format'),
            previewBtn: document.getElementById('previewBtn'),
            generateBtn: document.getElementById('generateBtn'),
            downloadBtn: document.getElementById('downloadBtn'),
            clearBtn: document.getElementById('clearBtn'),
            charCount: document.getElementById('charCount'),
            loading: document.getElementById('loading'),
            result: document.getElementById('result'),
            audioPlayer: document.getElementById('audioPlayer'),
            downloadLink: document.getElementById('downloadLink'),
            fileSize: document.getElementById('fileSize'),
            voiceInfo: document.getElementById('voiceInfo'),
            sizeInfo: document.getElementById('sizeInfo'),
            durationInfo: document.getElementById('durationInfo')
        };

        // Variables globales
        let currentAudioBlob = null;
        let currentAudioUrl = null;
        let userApiKey = null;
        let selectedVoiceType = 'male_deep';
        let speechSynthesis = window.speechSynthesis;

        // ============================================
        // INITIALISATION
        // ============================================

        // Initialiser le compteur
        updateCharCount();
        elements.textInput.addEventListener('input', updateCharCount);

        // Initialiser le slider de vitesse
        elements.speed.addEventListener('input', updateSpeedValue);

        // Charger la cl√© API sauvegard√©e
        loadSavedApiKey();

        // ============================================
        // FONCTIONS UTILITAIRES
        // ============================================

        function updateCharCount() {
            const count = elements.textInput.value.length;
            elements.charCount.textContent = count;
            
            if (count > 500) {
                elements.charCount.style.color = '#f44336';
                elements.charCount.innerHTML = `${count} <span style="color: #666">(trop long, r√©duire)</span>`;
            } else if (count > 300) {
                elements.charCount.style.color = '#ff9800';
            } else {
                elements.charCount.style.color = '#4caf50';
            }
        }

        function updateSpeedValue() {
            const value = parseFloat(elements.speed.value);
            let label = '';
            if (value < 0.9) label = 'Lente';
            else if (value > 1.1) label = 'Rapide';
            else label = 'Normale';
            elements.speedValue.textContent = `${label} (${value.toFixed(1)})`;
        }

        function selectVoice(voiceId) {
            // Mettre √† jour l'interface
            document.querySelectorAll('.voice-preset').forEach(preset => {
                preset.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            selectedVoiceType = voiceId;
            
            // Ajuster automatiquement la langue pour cette voix
            const voiceConfig = MALE_VOICE_CONFIGS[voiceId];
            if (voiceConfig) {
                elements.language.value = voiceConfig.voice;
            }
        }

        function saveApiKey() {
            const key = elements.apiKeyInput.value.trim();
            if (key) {
                localStorage.setItem('voiceRssApiKey', key);
                userApiKey = key;
                elements.apiStatus.textContent = '‚úÖ Cl√© API personnelle sauvegard√©e';
                elements.apiStatus.style.background = 'rgba(76, 175, 80, 0.2)';
                alert('Cl√© API sauvegard√©e !');
            } else {
                alert('Veuillez entrer une cl√© API valide');
            }
        }

        function loadSavedApiKey() {
            const savedKey = localStorage.getItem('voiceRssApiKey');
            if (savedKey) {
                elements.apiKeyInput.value = savedKey;
                userApiKey = savedKey;
                elements.apiStatus.textContent = '‚úÖ Utilisation de votre cl√© API personnelle';
                elements.apiStatus.style.background = 'rgba(76, 175, 80, 0.2)';
            } else {
                userApiKey = DEMO_API_KEY;
                elements.apiStatus.textContent = '‚úÖ Utilisation de la cl√© de d√©monstration avec voix masculine';
                elements.apiStatus.style.background = 'rgba(33, 150, 243, 0.2)';
            }
        }

        // ============================================
        // FONCTIONS PRINCIPALES
        // ============================================

        // Pr√©-√©couter avec le navigateur
        elements.previewBtn.addEventListener('click', function() {
            const text = elements.textInput.value.trim();
            if (!text) {
                alert('Veuillez entrer du texte d\'abord');
                return;
            }

            if (text.length > 1000) {
                if (!confirm('Le texte est long. Continuer ?')) {
                    return;
                }
            }

            // Arr√™ter toute lecture en cours
            speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text.substring(0, 500));
            utterance.rate = parseFloat(elements.speed.value);
            
            // Essayer de trouver une voix masculine
            const voices = speechSynthesis.getVoices();
            const maleVoice = voices.find(voice => 
                voice.lang.includes('fr') && 
                (voice.name.toLowerCase().includes('male') || 
                 voice.name.toLowerCase().includes('homme'))
            );

            if (maleVoice) {
                utterance.voice = maleVoice;
            }

            this.disabled = true;
            this.textContent = 'üîä Lecture...';

            utterance.onend = () => {
                this.disabled = false;
                this.textContent = '‚ñ∂Ô∏è Pr√©-√©couter';
            };

            utterance.onerror = () => {
                this.disabled = false;
                this.textContent = '‚ñ∂Ô∏è Pr√©-√©couter';
                alert('Erreur de lecture. G√©n√©rez l\'audio MP3 √† la place.');
            };

            speechSynthesis.speak(utterance);
        });

        // G√©n√©rer l'audio MP3 avec voix masculine
        elements.generateBtn.addEventListener('click', async function() {
            const text = elements.textInput.value.trim();
            
            if (!text) {
                alert('Veuillez entrer du texte d\'abord');
                return;
            }

            if (text.length > 1000) {
                alert('Texte trop long. Veuillez r√©duire √† 1000 caract√®res maximum.');
                return;
            }

            // Utiliser la cl√© API
            const apiKey = userApiKey || DEMO_API_KEY;
            
            // Afficher le chargement
            elements.loading.style.display = 'block';
            elements.result.style.display = 'none';
            this.disabled = true;
            this.textContent = '‚è≥ G√©n√©ration...';

            try {
                // G√©n√©rer avec VoiceRSS (configuration pour voix masculine)
                const audioBlob = await generateMaleVoiceWithVoiceRSS(text, apiKey);
                
                // Cr√©er l'URL pour l'audio
                if (currentAudioUrl) {
                    URL.revokeObjectURL(currentAudioUrl);
                }
                currentAudioUrl = URL.createObjectURL(audioBlob);
                currentAudioBlob = audioBlob;
                
                // Configurer le lecteur audio
                elements.audioPlayer.src = currentAudioUrl;
                
                // Mettre √† jour les informations
                const fileSize = (audioBlob.size / 1024).toFixed(1);
                const estimatedDuration = Math.ceil(text.length / 12);
                
                elements.fileSize.textContent = `(${fileSize} KB)`;
                elements.sizeInfo.textContent = `${fileSize} KB`;
                elements.durationInfo.textContent = `${estimatedDuration} secondes`;
                
                // Mettre √† jour le nom de la voix
                const voiceNames = {
                    'male_deep': 'Masculine - Voix Grave',
                    'male_warm': 'Masculine - Voix Chaude',
                    'male_professional': 'Masculine - Professionnelle'
                };
                elements.voiceInfo.textContent = voiceNames[selectedVoiceType];
                
                // Configurer le lien de t√©l√©chargement
                elements.downloadLink.href = currentAudioUrl;
                elements.downloadLink.download = `voix-masculine-${new Date().toISOString().slice(0,10)}.mp3`;
                elements.downloadLink.onclick = function(e) {
                    setTimeout(() => {
                        URL.revokeObjectURL(currentAudioUrl);
                    }, 100);
                };
                
                // Activer le bouton de t√©l√©chargement
                elements.downloadBtn.disabled = false;
                elements.downloadBtn.onclick = () => {
                    const link = document.createElement('a');
                    link.href = currentAudioUrl;
                    link.download = `voix-masculine-${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.mp3`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                };
                
                // Afficher le r√©sultat
                elements.loading.style.display = 'none';
                elements.result.style.display = 'block';
                
                // Jouer automatiquement
                setTimeout(() => {
                    elements.audioPlayer.play().catch(e => {
                        console.log("Cliquez sur play pour √©couter");
                    });
                }, 1000);
                
            } catch (error) {
                console.error('Erreur:', error);
                elements.loading.style.display = 'none';
                this.disabled = false;
                this.textContent = 'üéµ G√©n√©rer Audio MP3';
                
                // Solution de secours
                if (error.message.includes('API') || error.message.includes('VoiceRSS')) {
                    alert('Utilisation de la m√©thode de secours...');
                    try {
                        await generateWithFallbackAPI(text);
                    } catch (fallbackError) {
                        alert(`Erreur : ${fallbackError.message}\n\nVeuillez r√©essayer avec un texte plus court.`);
                    }
                } else {
                    alert(`Erreur : ${error.message}\n\nVeuillez v√©rifier votre connexion internet.`);
                }
            }
        });

        // Fonction pour g√©n√©rer avec VoiceRSS (configuration masculine)
        async function generateMaleVoiceWithVoiceRSS(text, apiKey) {
            return new Promise((resolve, reject) => {
                // Configuration pour voix masculine
                const voiceConfig = MALE_VOICE_CONFIGS[selectedVoiceType];
                const language = elements.language.value;
                const speed = parseFloat(elements.speed.value);
                
                // Convertir la vitesse (0.7-1.3) √† -10 √† 10 pour VoiceRSS
                const speedParam = Math.round((speed - 0.7) * (20/0.6)) - 10;
                
                // Param√®tres optimis√©s pour voix masculine
                const params = {
                    key: apiKey,
                    src: text.substring(0, 500), // Limiter pour qualit√©
                    hl: language, // Utiliser la langue s√©lectionn√©e
                    r: speedParam + voiceConfig.speed, // Ajuster avec la configuration
                    c: elements.format.value,
                    f: '44khz_16bit_stereo',
                    ssml: 'false',
                    b64: 'false'
                };
                
                // Construire l'URL
                const queryString = Object.keys(params)
                    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
                    .join('&');
                
                const apiUrl = `https://api.voicerss.org/?${queryString}`;
                
                console.log('G√©n√©ration avec configuration masculine:', voiceConfig);
                
                // Timeout
                const timeout = setTimeout(() => {
                    reject(new Error('D√©lai d√©pass√©. L\'API est lente.'));
                }, 15000);
                
                // T√©l√©charger l'audio
                fetch(apiUrl)
                    .then(response => {
                        clearTimeout(timeout);
                        if (!response.ok) {
                            throw new Error(`Erreur API: ${response.status}`);
                        }
                        return response.blob();
                    })
                    .then(blob => {
                        if (blob.size < 100) {
                            throw new Error('Fichier audio invalide');
                        }
                        resolve(blob);
                    })
                    .catch(error => {
                        clearTimeout(timeout);
                        reject(new Error(`√âchec de g√©n√©ration: ${error.message}`));
                    });
            });
        }

        // Solution de secours
        async function generateWithFallbackAPI(text) {
            const limitedText = text.substring(0, 300);
            
            // Utiliser l'API Google Translate TTS (alternative gratuite)
            const url = `https://translate.google.com/translate_tts?ie=UTF-8&tl=fr&client=tw-ob&q=${encodeURIComponent(limitedText)}`;
            
            const response = await fetch(url, {
                headers: {
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                }
            });
            
            if (!response.ok) throw new Error('API de secours √©chou√©e');
            
            const blob = await response.blob();
            
            // Mettre √† jour l'interface
            if (currentAudioUrl) URL.revokeObjectURL(currentAudioUrl);
            currentAudioUrl = URL.createObjectURL(blob);
            currentAudioBlob = blob;
            
            elements.audioPlayer.src = currentAudioUrl;
            elements.result.style.display = 'block';
            elements.downloadBtn.disabled = false;
            
            alert('Audio g√©n√©r√© avec m√©thode de secours (qualit√© r√©duite).');
        }

        // Effacer le texte
        elements.clearBtn.addEventListener('click', function() {
            elements.textInput.value = '';
            updateCharCount();
            elements.textInput.focus();
        });

        // ============================================
        // INITIALISATION FINALE
        // ============================================

        // Initialiser la valeur du slider
        updateSpeedValue();

        // Message de bienvenue
        console.log(`
        ========================================
        SYNTH√àSE VOCALE - VOIX MASCULINE
        ========================================
        Cette version est configur√©e pour g√©n√©rer
        des voix masculines naturelles.
        
        Configuration recommand√©e :
        ‚Ä¢ Langue: Fran√ßais Canadien (fr-ca)
        ‚Ä¢ Voix: "Voix Grave"
        ‚Ä¢ Limite: 500 caract√®res
        
        Bonne utilisation !
        ========================================
        `);
    </script>
</body>
</html>
