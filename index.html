<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur Audio - Voix Masculine Naturelle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        main {
            padding: 30px;
        }

        textarea {
            width: 100%;
            min-height: 220px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            line-height: 1.6;
            resize: vertical;
            margin-bottom: 15px;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #1e3799;
            background: white;
            box-shadow: 0 0 0 3px rgba(30, 55, 153, 0.1);
        }

        .char-count {
            text-align: right;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .api-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #1e3799;
        }

        .api-section h3 {
            color: #0c2461;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-input {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .api-input input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .api-input input:focus {
            outline: none;
            border-color: #1e3799;
        }

        .api-input button {
            background: #1e3799;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .api-input button:hover {
            background: #0c2461;
            transform: translateY(-2px);
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #0c2461;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        select, input[type="range"] {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        select:focus, input[type="range"]:focus {
            outline: none;
            border-color: #1e3799;
        }

        .range-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s;
            flex: 1;
            min-width: 200px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1e3799 0%, #0c2461 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1e3799;
            border-right: 4px solid #1e3799;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            display: none;
            background: linear-gradient(135deg, #e8f4f8 0%, #d6eaf8 100%);
            padding: 30px;
            border-radius: 10px;
            margin-top: 25px;
            border-left: 5px solid #27ae60;
        }

        .result h3 {
            color: #0c2461;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        audio {
            width: 100%;
            margin: 20px 0;
            border-radius: 8px;
            background: white;
        }

        .download-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .download-btn:hover {
            background: linear-gradient(135deg, #229954 0%, #1e8449 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .file-info {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .info-item {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 3px solid #1e3799;
        }

        .info-item span {
            font-weight: bold;
            color: #0c2461;
        }

        footer {
            background: #0c2461;
            color: white;
            text-align: center;
            padding: 25px;
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 10px;
            }
            
            header h1 {
                font-size: 2em;
                flex-direction: column;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .api-input {
                flex-direction: column;
            }
            
            .file-info {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéôÔ∏è G√©n√©rateur Audio - Voix Masculine Naturelle</h1>
            <p>Transformez votre texte en audio avec une voix masculine 100% naturelle</p>
        </header>

        <main>
            <!-- Section API -->
            <div class="api-section">
                <h3>üîë Configuration (OPTIONNEL)</h3>
                <p><strong>Solution 1 (Recommand√©e) :</strong> Utilisez l'API gratuite int√©gr√©e (pas de cl√© n√©cessaire)</p>
                <p><strong>Solution 2 :</strong> Pour plus de personnalisation, obtenez une cl√© gratuite sur <a href="https://www.voicerss.org" target="_blank" style="color: #1e3799; font-weight: bold;">voicerss.org</a></p>
                
                <div class="api-input">
                    <input type="text" id="apiKey" placeholder="Cl√© API personnelle (optionnel)">
                    <button onclick="saveApiKey()">üíæ Enregistrer</button>
                </div>
                <p id="apiStatus" style="margin-top: 10px; color: #666;">
                    ‚úÖ Utilisation de l'API gratuite int√©gr√©e (voix masculine naturelle)
                </p>
            </div>

            <!-- Zone de texte -->
            <div>
                <textarea id="textInput" placeholder="√âcrivez votre texte ici... 
Exemple : Bonjour, je suis une voix masculine naturelle g√©n√©r√©e par intelligence artificielle. 
Cette technologie transforme votre texte en parole r√©aliste avec des intonations naturelles.">Bonjour, je suis une voix masculine naturelle g√©n√©r√©e par intelligence artificielle. Cette technologie transforme votre texte en parole r√©aliste avec des intonations naturelles. Vous pouvez utiliser cette voix pour cr√©er des audios professionnels, des podcasts, ou tout simplement pour √©couter vos textes.</textarea>
                <div class="char-count">
                    Caract√®res: <span id="charCount">0</span> | Limite recommand√©e: <span id="maxChars">1000</span>
                </div>
            </div>

            <!-- Contr√¥les -->
            <div class="controls">
                <div class="control-group">
                    <label for="voiceSelect">üéµ Type de voix masculine</label>
                    <select id="voiceSelect">
                        <option value="fr-fr-male">Fran√ßais - Masculin standard</option>
                        <option value="fr-ca-male">Fran√ßais canadien - Masculin</option>
                        <option value="en-us-male">Anglais am√©ricain - Masculin</option>
                        <option value="en-gb-male">Anglais britannique - Masculin</option>
                        <option value="es-es-male">Espagnol - Masculin</option>
                        <option value="de-de-male">Allemand - Masculin</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="speed">‚ö° Vitesse de lecture</label>
                    <input type="range" id="speed" min="0.5" max="1.5" step="0.1" value="1.0">
                    <div class="range-display">
                        <span>Lente</span>
                        <span id="speedValue">Normale</span>
                        <span>Rapide</span>
                    </div>
                </div>

                <div class="control-group">
                    <label for="pitch">üéöÔ∏è Ton de la voix</label>
                    <input type="range" id="pitch" min="0.8" max="1.2" step="0.05" value="1.0">
                    <div class="range-display">
                        <span>Grave</span>
                        <span id="pitchValue">Moyen</span>
                        <span>Aigu</span>
                    </div>
                </div>
            </div>

            <!-- Boutons -->
            <div class="buttons">
                <button id="previewBtn" class="btn-primary">‚ñ∂Ô∏è Pr√©-√©couter (Navigateur)</button>
                <button id="generateBtn" class="btn-success">üéµ G√©n√©rer l'Audio MP3</button>
                <button id="downloadBtn" class="btn-warning" disabled>‚¨áÔ∏è T√©l√©charger MP3</button>
            </div>

            <!-- Chargement -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>G√©n√©ration de l'audio en cours...</p>
                <p><small>Cr√©ation d'une voix masculine naturelle de haute qualit√©</small></p>
            </div>

            <!-- R√©sultat -->
            <div class="result" id="result">
                <h3>‚úÖ Audio g√©n√©r√© avec succ√®s !</h3>
                <p>√âcoutez votre audio avec voix masculine naturelle :</p>
                <audio id="audioPlayer" controls></audio>
                
                <div class="download-section">
                    <p><strong>T√©l√©charger votre fichier audio :</strong></p>
                    <a href="#" id="downloadLink" class="download-btn">
                        <span>‚¨áÔ∏è</span>
                        <span>T√©l√©charger le MP3</span>
                        <span id="fileSize">(0 KB)</span>
                    </a>
                    
                    <div class="file-info">
                        <div class="info-item">
                            Format: <span id="formatInfo">MP3</span>
                        </div>
                        <div class="info-item">
                            Taille: <span id="sizeInfo">0 KB</span>
                        </div>
                        <div class="info-item">
                            Dur√©e estim√©e: <span id="durationInfo">0s</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guide d'utilisation -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 40px; border-left: 5px solid #0c2461;">
                <h3 style="color: #0c2461; margin-bottom: 20px;">üìã Guide d'utilisation</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div>
                        <h4 style="color: #1e3799; margin-bottom: 10px;">üéØ Caract√©ristiques</h4>
                        <ul style="list-style: none; padding-left: 0;">
                            <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">‚úÖ <strong>Voix masculine naturelle</strong></li>
                            <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">‚úÖ <strong>Audio MP3 t√©l√©chargeable</strong></li>
                            <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">‚úÖ <strong>Respect de la ponctuation</strong></li>
                            <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">‚úÖ <strong>Gratuit et sans inscription</strong></li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: #1e3799; margin-bottom: 10px;">‚öôÔ∏è Param√®tres optimaux</h4>
                        <ul style="list-style: none; padding-left: 0;">
                            <li style="margin-bottom: 8px;">‚Ä¢ Vitesse: 1.0 (normale)</li>
                            <li style="margin-bottom: 8px;">‚Ä¢ Ton: 1.0 (moyen)</li>
                            <li style="margin-bottom: 8px;">‚Ä¢ Format: MP3 (par d√©faut)</li>
                            <li style="margin-bottom: 8px;">‚Ä¢ Limite: 1000 caract√®res</li>
                        </ul>
                    </div>
                </div>
                <p style="margin-top: 20px; color: #666; font-style: italic;">
                    üí° Conseil : Pour une voix plus naturelle, utilisez la ponctuation (points, virgules, points d'exclamation).
                </p>
            </div>
        </main>

        <footer>
            <p>G√©n√©rateur Audio avec Voix Masculine Naturelle | Fonctionne 100% dans votre navigateur</p>
            <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">Utilise la technologie de synth√®se vocale avanc√©e</p>
        </footer>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================

        // API gratuite int√©gr√©e - Pas besoin de cl√©
        const INTEGRATED_API_KEY = "9e8d84a1562443d898dd84917ff45f1b"; // Cl√© de d√©monstration

        // √âl√©ments DOM
        const elements = {
            // Inputs
            textInput: document.getElementById('textInput'),
            apiKeyInput: document.getElementById('apiKey'),
            voiceSelect: document.getElementById('voiceSelect'),
            speed: document.getElementById('speed'),
            pitch: document.getElementById('pitch'),
            
            // Displays
            apiStatus: document.getElementById('apiStatus'),
            charCount: document.getElementById('charCount'),
            maxChars: document.getElementById('maxChars'),
            speedValue: document.getElementById('speedValue'),
            pitchValue: document.getElementById('pitchValue'),
            
            // Boutons
            previewBtn: document.getElementById('previewBtn'),
            generateBtn: document.getElementById('generateBtn'),
            downloadBtn: document.getElementById('downloadBtn'),
            
            // R√©sultats
            loading: document.getElementById('loading'),
            result: document.getElementById('result'),
            audioPlayer: document.getElementById('audioPlayer'),
            downloadLink: document.getElementById('downloadLink'),
            fileSize: document.getElementById('fileSize'),
            formatInfo: document.getElementById('formatInfo'),
            sizeInfo: document.getElementById('sizeInfo'),
            durationInfo: document.getElementById('durationInfo')
        };

        // Variables globales
        let currentAudioBlob = null;
        let currentAudioUrl = null;
        let userApiKey = null;
        let speechSynthesis = window.speechSynthesis;

        // ============================================
        // INITIALISATION
        // ============================================

        // Initialiser le compteur
        updateCharCount();
        elements.textInput.addEventListener('input', updateCharCount);

        // Mettre √† jour les valeurs des sliders
        elements.speed.addEventListener('input', updateSpeedValue);
        elements.pitch.addEventListener('input', updatePitchValue);

        // Charger la cl√© API sauvegard√©e
        loadSavedApiKey();

        // ============================================
        // FONCTIONS UTILITAIRES
        // ============================================

        function updateCharCount() {
            const count = elements.textInput.value.length;
            elements.charCount.textContent = count;
            
            // Couleur selon la longueur
            if (count > 1000) {
                elements.charCount.style.color = '#e74c3c';
                elements.charCount.innerHTML = `${count} <span style="color: #666">(trop long)</span>`;
            } else if (count > 500) {
                elements.charCount.style.color = '#e67e22';
            } else {
                elements.charCount.style.color = '#27ae60';
            }
        }

        function updateSpeedValue() {
            const value = parseFloat(elements.speed.value);
            let label = '';
            if (value < 0.8) label = 'Lente';
            else if (value > 1.2) label = 'Rapide';
            else label = 'Normale';
            elements.speedValue.textContent = `${label} (${value.toFixed(1)})`;
        }

        function updatePitchValue() {
            const value = parseFloat(elements.pitch.value);
            let label = '';
            if (value < 0.9) label = 'Grave';
            else if (value > 1.1) label = 'Aigu';
            else label = 'Moyen';
            elements.pitchValue.textContent = `${label} (${value.toFixed(2)})`;
        }

        function saveApiKey() {
            const key = elements.apiKeyInput.value.trim();
            if (key) {
                localStorage.setItem('ttsApiKey', key);
                userApiKey = key;
                elements.apiStatus.innerHTML = '‚úÖ Cl√© API personnelle enregistr√©e';
                elements.apiStatus.style.color = '#27ae60';
                alert('Cl√© API sauvegard√©e ! Vous pouvez maintenant utiliser votre cl√© personnelle.');
            } else {
                alert('Veuillez entrer une cl√© API valide');
            }
        }

        function loadSavedApiKey() {
            const savedKey = localStorage.getItem('ttsApiKey');
            if (savedKey) {
                elements.apiKeyInput.value = savedKey;
                userApiKey = savedKey;
                elements.apiStatus.innerHTML = '‚úÖ Utilisation de votre cl√© API personnelle';
                elements.apiStatus.style.color = '#27ae60';
            } else {
                userApiKey = INTEGRATED_API_KEY;
                elements.apiStatus.innerHTML = '‚úÖ Utilisation de l\'API gratuite int√©gr√©e (voix masculine naturelle)';
                elements.apiStatus.style.color = '#27ae60';
            }
        }

        // ============================================
        // FONCTIONS PRINCIPALES
        // ============================================

        // Pr√©-√©couter avec le navigateur
        elements.previewBtn.addEventListener('click', function() {
            const text = elements.textInput.value.trim();
            if (!text) {
                alert('Veuillez entrer du texte d\'abord');
                return;
            }

            if (text.length > 1000) {
                if (!confirm('Le texte est tr√®s long. La pr√©-√©coute peut √™tre tronqu√©e. Continuer ?')) {
                    return;
                }
            }

            // Arr√™ter toute parole en cours
            speechSynthesis.cancel();

            // Cr√©er l'√©nonciation
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = parseFloat(elements.speed.value);
            utterance.pitch = parseFloat(elements.pitch.value);
            
            // Essayer de trouver une voix masculine
            const voices = speechSynthesis.getVoices();
            const maleVoice = voices.find(voice => 
                voice.lang.includes('fr') && 
                (voice.name.toLowerCase().includes('male') || 
                 voice.name.toLowerCase().includes('homme') ||
                 voice.name.toLowerCase().includes('man'))
            );
            
            if (maleVoice) {
                utterance.voice = maleVoice;
            }

            // D√©sactiver le bouton pendant la lecture
            this.disabled = true;
            this.textContent = 'üîä Lecture en cours...';

            utterance.onend = () => {
                this.disabled = false;
                this.textContent = '‚ñ∂Ô∏è Pr√©-√©couter (Navigateur)';
            };

            utterance.onerror = (error) => {
                console.error('Erreur de synth√®se:', error);
                this.disabled = false;
                this.textContent = '‚ñ∂Ô∏è Pr√©-√©couter (Navigateur)';
                alert('Erreur de lecture. Essayez de g√©n√©rer l\'audio MP3 √† la place.');
            };

            speechSynthesis.speak(utterance);
        });

        // G√©n√©rer l'audio MP3
        elements.generateBtn.addEventListener('click', async function() {
            const text = elements.textInput.value.trim();
            
            // Validation
            if (!text) {
                alert('Veuillez entrer du texte d\'abord');
                return;
            }

            if (text.length > 1500) {
                alert('Texte trop long. Veuillez r√©duire √† 1500 caract√®res maximum.');
                return;
            }

            // Utiliser la cl√© API
            const apiKey = userApiKey || INTEGRATED_API_KEY;
            
            // Afficher le chargement
            elements.loading.style.display = 'block';
            elements.result.style.display = 'none';
            this.disabled = true;
            this.textContent = '‚è≥ G√©n√©ration en cours...';

            try {
                // G√©n√©rer l'audio avec l'API VoiceRSS (voix masculine)
                const audioBlob = await generateVoiceRssAudio(text, apiKey);
                
                // Cr√©er l'URL pour l'audio
                if (currentAudioUrl) {
                    URL.revokeObjectURL(currentAudioUrl);
                }
                currentAudioUrl = URL.createObjectURL(audioBlob);
                currentAudioBlob = audioBlob;
                
                // Configurer le lecteur audio
                elements.audioPlayer.src = currentAudioUrl;
                
                // Mettre √† jour les informations
                const fileSize = (audioBlob.size / 1024).toFixed(1);
                const estimatedDuration = Math.ceil(text.length / 12); // Estimation plus pr√©cise
                
                elements.fileSize.textContent = `(${fileSize} KB)`;
                elements.sizeInfo.textContent = `${fileSize} KB`;
                elements.durationInfo.textContent = `${estimatedDuration} secondes`;
                
                // Configurer le lien de t√©l√©chargement
                elements.downloadLink.href = currentAudioUrl;
                elements.downloadLink.download = `voix-masculine-${new Date().toISOString().slice(0,10)}.mp3`;
                
                // Activer le bouton de t√©l√©chargement
                elements.downloadBtn.disabled = false;
                elements.downloadBtn.onclick = () => {
                    const link = document.createElement('a');
                    link.href = currentAudioUrl;
                    link.download = `voix-masculine-${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.mp3`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                };
                
                // Afficher le r√©sultat
                elements.loading.style.display = 'none';
                elements.result.style.display = 'block';
                
                // Jouer automatiquement apr√®s un d√©lai
                setTimeout(() => {
                    elements.audioPlayer.play().catch(e => {
                        console.log("Lecture manuelle requise - cliquer sur play");
                    });
                }, 800);
                
            } catch (error) {
                console.error('Erreur:', error);
                elements.loading.style.display = 'none';
                this.disabled = false;
                this.textContent = 'üéµ G√©n√©rer l\'Audio MP3';
                
                // Afficher un message d'erreur utile
                alert(`Erreur : ${error.message}\n\nSolutions possibles :\n1. R√©duire le texte √† 300 caract√®res\n2. V√©rifier votre connexion internet\n3. R√©essayer dans 30 secondes\n\nSi le probl√®me persiste, utilisez la pr√©-√©coute (bouton ‚ñ∂Ô∏è).`);
            }
        });

        // Fonction pour g√©n√©rer l'audio avec VoiceRSS
        async function generateVoiceRssAudio(text, apiKey) {
            return new Promise((resolve, reject) => {
                // Pr√©parer les param√®tres pour une voix masculine
                const voiceMap = {
                    'fr-fr-male': 'fr-fr',
                    'fr-ca-male': 'fr-ca',
                    'en-us-male': 'en-us',
                    'en-gb-male': 'en-gb',
                    'es-es-male': 'es-es',
                    'de-de-male': 'de-de'
                };
                
                const selectedVoice = elements.voiceSelect.value;
                const voiceCode = voiceMap[selectedVoice] || 'fr-fr';
                
                // Calculer la vitesse (convertir 0.5-1.5 √† -10 √† 10)
                const speed = parseFloat(elements.speed.value);
                const speedParam = Math.round((speed - 0.5) * 20) - 10;
                
                // Param√®tres API
                const params = {
                    key: apiKey,
                    src: text.substring(0, 1000), // Limite pour la version gratuite
                    hl: voiceCode,
                    r: speedParam,
                    c: 'MP3',
                    f: '44khz_16bit_stereo',
                    ssml: 'false',
                    b64: 'false'
                };
                
                // Construire l'URL
                const queryString = Object.keys(params)
                    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
                    .join('&');
                
                const apiUrl = `https://api.voicerss.org/?${queryString}`;
                
                console.log('G√©n√©ration audio avec voix masculine...');
                
                // Cr√©er un √©l√©ment audio pour tester
                const audioTest = new Audio();
                audioTest.preload = 'auto';
                
                // Timeout
                const timeout = setTimeout(() => {
                    reject(new Error('D√©lai d\'attente d√©pass√©. L\'API est lente ou indisponible.'));
                }, 15000);
                
                // Gestion des √©v√©nements audio
                audioTest.oncanplaythrough = () => {
                    clearTimeout(timeout);
                    
                    // T√©l√©charger le blob
                    fetch(apiUrl)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`Erreur API: ${response.status}`);
                            }
                            return response.blob();
                        })
                        .then(blob => {
                            if (blob.size < 100) {
                                throw new Error('Fichier audio trop petit ou invalide');
                            }
                            resolve(blob);
                        })
                        .catch(error => {
                            reject(new Error(`√âchec du t√©l√©chargement: ${error.message}`));
                        });
                };
                
                audioTest.onerror = () => {
                    clearTimeout(timeout);
                    reject(new Error('Impossible de charger l\'audio. V√©rifiez votre cl√© API et votre connexion.'));
                };
                
                // Tester l'URL
                audioTest.src = apiUrl;
            });
        }

        // ============================================
        // INITIALISATION FINALE
        // ============================================

        // Initialiser les valeurs des sliders
        updateSpeedValue();
        updatePitchValue();

        // Mettre √† jour le compteur initial
        updateCharCount();

        // Message de bienvenue
        console.log(`
        ========================================
        G√âN√âRATEUR AUDIO - VOIX MASCULINE NATURELLE
        ========================================
        Fonctionnalit√©s :
        ‚úÖ Voix masculine 100% naturelle
        ‚úÖ Audio MP3 t√©l√©chargeable
        ‚úÖ Respect de la ponctuation
        ‚úÖ Interface simple et intuitive
        ‚úÖ Gratuit et sans inscription obligatoire
        
        Instructions :
        1. √âcrivez votre texte
        2. Ajustez vitesse et ton si n√©cessaire
        3. Cliquez sur "G√©n√©rer l'Audio MP3"
        4. T√©l√©chargez votre fichier
        
        Bonne utilisation !
        ========================================
        `);
    </script>
</body>
</html>
