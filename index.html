<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synth√®se Vocale Homme Naturelle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(25, 25, 40, 0.9);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            overflow: hidden;
            border: 1px solid #2d4059;
        }

        header {
            background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 2px solid #2d4059;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #4d96ff;
            text-shadow: 0 2px 10px rgba(77, 150, 255, 0.3);
        }

        main {
            padding: 30px;
        }

        .api-section {
            background: rgba(13, 27, 42, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid #4d96ff;
        }

        .api-section h3 {
            color: #4d96ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-input {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .api-input input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #2d4059;
            border-radius: 8px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s;
        }

        .api-input input:focus {
            outline: none;
            border-color: #4d96ff;
            background: rgba(255, 255, 255, 0.15);
        }

        .api-input button {
            background: linear-gradient(135deg, #4d96ff 0%, #357ae8 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .api-input button:hover {
            background: linear-gradient(135deg, #357ae8 0%, #2b6cd3 100%);
            transform: translateY(-2px);
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #2d4059;
            border-radius: 10px;
            font-size: 16px;
            line-height: 1.6;
            resize: vertical;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            transition: all 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #4d96ff;
            background: rgba(255, 255, 255, 0.1);
        }

        .char-count {
            text-align: right;
            color: #8da1b8;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .voice-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .voice-option {
            background: rgba(45, 64, 89, 0.5);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #2d4059;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .voice-option:hover {
            border-color: #4d96ff;
            transform: translateY(-3px);
            background: rgba(45, 64, 89, 0.8);
        }

        .voice-option.active {
            background: linear-gradient(135deg, #4d96ff 0%, #2d4059 100%);
            border-color: #4d96ff;
            box-shadow: 0 5px 15px rgba(77, 150, 255, 0.3);
        }

        .voice-option .icon {
            font-size: 24px;
            margin-bottom: 10px;
            color: #4d96ff;
        }

        .voice-option.active .icon {
            color: white;
        }

        .voice-option h4 {
            margin-bottom: 5px;
            color: #e1e8f0;
        }

        .voice-option p {
            font-size: 0.9em;
            color: #8da1b8;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(13, 27, 42, 0.5);
            border-radius: 10px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #e1e8f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        select, input[type="range"] {
            padding: 10px;
            border: 2px solid #2d4059;
            border-radius: 8px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        select:focus, input[type="range"]:focus {
            outline: none;
            border-color: #4d96ff;
        }

        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            background: #2d4059;
            border-radius: 4px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #4d96ff;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
        }

        .range-value {
            text-align: center;
            font-size: 0.9em;
            color: #8da1b8;
            margin-top: 5px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            flex: 1;
            min-width: 180px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4d96ff 0%, #357ae8 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fdcb6e 0%, #f9a825 100%);
            color: #333;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            background: rgba(13, 27, 42, 0.8);
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4d96ff;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #4d96ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            display: none;
            background: rgba(13, 27, 42, 0.8);
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid #00b894;
        }

        .result h3 {
            color: #00b894;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        audio {
            width: 100%;
            margin: 15px 0;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
        }

        .download-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #2d4059;
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
        }

        .download-btn:hover {
            background: linear-gradient(135deg, #00a085 0%, #008b74 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.3);
        }

        .file-info {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .info-item {
            background: rgba(45, 64, 89, 0.5);
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 3px solid #4d96ff;
            color: #e1e8f0;
        }

        footer {
            background: rgba(13, 27, 42, 0.9);
            color: #8da1b8;
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-top: 1px solid #2d4059;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 10px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .api-input {
                flex-direction: column;
            }
            
            .voice-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéôÔ∏è Synth√®se Vocale Homme Naturelle</h1>
            <p>Texte ‚Üí Voix d'homme ‚Üí T√©l√©chargement MP3</p>
        </header>

        <main>
            <!-- Section API -->
            <div class="api-section">
                <h3>üîë Configuration API</h3>
                <p>Pour g√©n√©rer des voix d'homme naturelles, utilisez cette cl√© de d√©monstration.</p>
                <p>Pour votre propre cl√© : <a href="https://www.voicerss.org" target="_blank" style="color: #4d96ff;">voicerss.org</a></p>
                
                <div class="api-input">
                    <input type="text" id="apiKey" placeholder="Votre cl√© API VoiceRSS" value="9e8d84a1562443d898dd84917ff45f1b">
                    <button onclick="saveApiKey()">üíæ Sauvegarder</button>
                </div>
                <p id="apiStatus" style="margin-top: 10px; padding: 10px; background: rgba(77, 150, 255, 0.1); border-radius: 5px;">
                    ‚úÖ Utilisation de la cl√© de d√©monstration avec voix d'homme
                </p>
            </div>

            <!-- Zone de texte -->
            <div>
                <textarea id="textInput" placeholder="√âcrivez votre texte ici... (max 300 caract√®res pour une meilleure qualit√©)">Bonjour, je suis une voix d'homme naturelle. Contrairement aux synth√®ses vocales traditionnelles, ma voix sonne comme celle d'un vrai homme. J'ai un timbre grave et chaleureux, id√©al pour des pr√©sentations professionnelles, des podcasts ou tout autre contenu audio n√©cessitant une voix d'homme authentique.</textarea>
                <div class="char-count">
                    Caract√®res: <span id="charCount">0</span> | Recommand√©: moins de 300 caract√®res
                </div>
            </div>

            <!-- S√©lection de voix d'homme -->
            <div>
                <h3 style="color: #e1e8f0; margin-bottom: 15px;">üéØ S√©lectionnez votre voix d'homme :</h3>
                <div class="voice-options">
                    <div class="voice-option active" onclick="selectVoice('homme_profond')">
                        <div class="icon">üéôÔ∏è</div>
                        <h4>Homme Profond</h4>
                        <p>Voix grave d'homme m√ªr</p>
                    </div>
                    <div class="voice-option" onclick="selectVoice('homme_chaleureux')">
                        <div class="icon">üî•</div>
                        <h4>Homme Chaleureux</h4>
                        <p>Ton amical et engageant</p>
                    </div>
                    <div class="voice-option" onclick="selectVoice('homme_professionnel')">
                        <div class="icon">üíº</div>
                        <h4>Homme Professionnel</h4>
                        <p>Clair et articul√©</p>
                    </div>
                    <div class="voice-option" onclick="selectVoice('homme_jeune')">
                        <div class="icon">üë®‚Äçüíº</div>
                        <h4>Homme Jeune</h4>
                        <p>√ânergique et moderne</p>
                    </div>
                </div>
            </div>

            <!-- Contr√¥les -->
            <div class="controls">
                <div class="control-group">
                    <label for="language">üåç Langue :</label>
                    <select id="language">
                        <option value="fr-ca">Fran√ßais Canadien (homme)</option>
                        <option value="fr-fr">Fran√ßais France (homme)</option>
                        <option value="en-us">Anglais Am√©ricain (man)</option>
                        <option value="en-gb">Anglais Britannique (man)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="speed">‚ö° Vitesse :</label>
                    <input type="range" id="speed" min="0.7" max="1.3" step="0.1" value="1.0">
                    <div class="range-value" id="speedValue">Normale (1.0)</div>
                </div>

                <div class="control-group">
                    <label for="format">üéµ Format :</label>
                    <select id="format">
                        <option value="mp3">MP3 (recommand√©)</option>
                        <option value="wav">WAV</option>
                        <option value="ogg">OGG</option>
                    </select>
                </div>
            </div>

            <!-- Boutons -->
            <div class="buttons">
                <button id="previewBtn" class="btn-primary">‚ñ∂Ô∏è √âcouter l'aper√ßu</button>
                <button id="generateBtn" class="btn-success">üéµ G√©n√©rer Audio Homme</button>
                <button id="downloadBtn" class="btn-warning" disabled>‚¨áÔ∏è T√©l√©charger MP3</button>
                <button id="clearBtn" class="btn-danger">üóëÔ∏è Effacer</button>
            </div>

            <!-- Chargement -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>G√©n√©ration de la voix d'homme en cours...</p>
                <p><small>Cr√©ation d'un fichier audio haute qualit√©</small></p>
            </div>

            <!-- R√©sultat -->
            <div class="result" id="result">
                <h3>‚úÖ Audio Homme G√©n√©r√© !</h3>
                <p>√âcoutez votre texte avec une voix d'homme naturelle :</p>
                <audio id="audioPlayer" controls></audio>
                
                <div class="download-section">
                    <p><strong>T√©l√©charger votre fichier audio :</strong></p>
                    <a href="#" id="downloadLink" class="download-btn">
                        <span>‚¨áÔ∏è</span>
                        <span>T√©l√©charger le MP3</span>
                        <span id="fileSize">(0 KB)</span>
                    </a>
                    
                    <div class="file-info">
                        <div class="info-item">
                            <strong>Voix :</strong> <span id="voiceInfo">Homme Profond</span>
                        </div>
                        <div class="info-item">
                            <strong>Taille :</strong> <span id="sizeInfo">0 KB</span>
                        </div>
                        <div class="info-item">
                            <strong>Dur√©e :</strong> <span id="durationInfo">~0 secondes</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div style="background: rgba(13, 27, 42, 0.5); padding: 25px; border-radius: 10px; margin-top: 30px; border-left: 5px solid #4d96ff;">
                <h3 style="color: #4d96ff; margin-bottom: 15px;">üìã Guide pour une voix d'homme parfaite :</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div style="background: rgba(45, 64, 89, 0.5); padding: 15px; border-radius: 8px;">
                        <h4 style="color: #4d96ff;">1. Choisissez "Fran√ßais Canadien"</h4>
                        <p>Cette langue a les meilleures voix d'homme</p>
                    </div>
                    <div style="background: rgba(45, 64, 89, 0.5); padding: 15px; border-radius: 8px;">
                        <h4 style="color: #4d96ff;">2. S√©lectionnez "Homme Profond"</h4>
                        <p>Pour le timbre le plus masculin</p>
                    </div>
                    <div style="background: rgba(45, 64, 89, 0.5); padding: 15px; border-radius: 8px;">
                        <h4 style="color: #4d96ff;">3. Limitez √† 300 caract√®res</h4>
                        <p>Pour une qualit√© audio optimale</p>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>Synth√®se Vocale avec Voix d'Homme Naturelle | Utilise VoiceRSS API</p>
        </footer>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================

        // Cl√© API de d√©monstration (avec support voix homme)
        const DEMO_API_KEY = "9e8d84a1562443d898dd84917ff45f1b";

        // Configuration des voix homme
        const HOMME_VOICE_CONFIGS = {
            'homme_profond': {
                language: 'fr-ca',
                speed: -3,
                pitch: -4,
                name: 'Homme Profond'
            },
            'homme_chaleureux': {
                language: 'fr-ca',
                speed: 0,
                pitch: -2,
                name: 'Homme Chaleureux'
            },
            'homme_professionnel': {
                language: 'en-us',
                speed: -2,
                pitch: -3,
                name: 'Homme Professionnel'
            },
            'homme_jeune': {
                language: 'en-us',
                speed: 1,
                pitch: -1,
                name: 'Homme Jeune'
            }
        };

        // √âl√©ments DOM
        const elements = {
            textInput: document.getElementById('textInput'),
            apiKeyInput: document.getElementById('apiKey'),
            apiStatus: document.getElementById('apiStatus'),
            language: document.getElementById('language'),
            speed: document.getElementById('speed'),
            speedValue: document.getElementById('speedValue'),
            format: document.getElementById('format'),
            previewBtn: document.getElementById('previewBtn'),
            generateBtn: document.getElementById('generateBtn'),
            downloadBtn: document.getElementById('downloadBtn'),
            clearBtn: document.getElementById('clearBtn'),
            charCount: document.getElementById('charCount'),
            loading: document.getElementById('loading'),
            result: document.getElementById('result'),
            audioPlayer: document.getElementById('audioPlayer'),
            downloadLink: document.getElementById('downloadLink'),
            fileSize: document.getElementById('fileSize'),
            voiceInfo: document.getElementById('voiceInfo'),
            sizeInfo: document.getElementById('sizeInfo'),
            durationInfo: document.getElementById('durationInfo')
        };

        // Variables globales
        let currentAudioBlob = null;
        let currentAudioUrl = null;
        let userApiKey = null;
        let selectedVoiceType = 'homme_profond';
        let speechSynthesis = window.speechSynthesis;

        // ============================================
        // INITIALISATION
        // ============================================

        // Initialiser le compteur
        updateCharCount();
        elements.textInput.addEventListener('input', updateCharCount);

        // Initialiser le slider de vitesse
        elements.speed.addEventListener('input', updateSpeedValue);

        // Charger la cl√© API sauvegard√©e
        loadSavedApiKey();

        // ============================================
        // FONCTIONS UTILITAIRES
        // ============================================

        function updateCharCount() {
            const count = elements.textInput.value.length;
            elements.charCount.textContent = count;
            
            if (count > 300) {
                elements.charCount.style.color = '#e17055';
                elements.charCount.innerHTML = `${count} <span style="color: #8da1b8">(trop long, r√©duire)</span>`;
            } else if (count > 200) {
                elements.charCount.style.color = '#fdcb6e';
            } else {
                elements.charCount.style.color = '#00b894';
            }
        }

        function updateSpeedValue() {
            const value = parseFloat(elements.speed.value);
            let label = '';
            if (value < 0.9) label = 'Lente';
            else if (value > 1.1) label = 'Rapide';
            else label = 'Normale';
            elements.speedValue.textContent = `${label} (${value.toFixed(1)})`;
        }

        function selectVoice(voiceId) {
            // Mettre √† jour l'interface
            document.querySelectorAll('.voice-option').forEach(preset => {
                preset.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            selectedVoiceType = voiceId;
            
            // Ajuster automatiquement la langue pour cette voix
            const voiceConfig = HOMME_VOICE_CONFIGS[voiceId];
            if (voiceConfig) {
                elements.language.value = voiceConfig.language;
            }
            
            // Mettre √† jour le nom de la voix
            updateVoiceInfo();
        }

        function updateVoiceInfo() {
            const voiceConfig = HOMME_VOICE_CONFIGS[selectedVoiceType];
            elements.voiceInfo.textContent = voiceConfig.name;
        }

        function saveApiKey() {
            const key = elements.apiKeyInput.value.trim();
            if (key) {
                localStorage.setItem('voiceRssApiKey', key);
                userApiKey = key;
                elements.apiStatus.textContent = '‚úÖ Cl√© API personnelle sauvegard√©e';
                elements.apiStatus.style.background = 'rgba(0, 184, 148, 0.1)';
                alert('Cl√© API sauvegard√©e !');
            } else {
                alert('Veuillez entrer une cl√© API valide');
            }
        }

        function loadSavedApiKey() {
            const savedKey = localStorage.getItem('voiceRssApiKey');
            if (savedKey) {
                elements.apiKeyInput.value = savedKey;
                userApiKey = savedKey;
                elements.apiStatus.textContent = '‚úÖ Utilisation de votre cl√© API personnelle';
                elements.apiStatus.style.background = 'rgba(0, 184, 148, 0.1)';
            } else {
                userApiKey = DEMO_API_KEY;
                elements.apiStatus.textContent = '‚úÖ Utilisation de la cl√© de d√©monstration avec voix d\'homme';
                elements.apiStatus.style.background = 'rgba(77, 150, 255, 0.1)';
            }
        }

        // ============================================
        // FONCTIONS PRINCIPALES
        // ============================================

        // Pr√©-√©couter avec le navigateur
        elements.previewBtn.addEventListener('click', function() {
            const text = elements.textInput.value.trim();
            if (!text) {
                alert('Veuillez entrer du texte d\'abord');
                return;
            }

            if (text.length > 500) {
                if (!confirm('Le texte est long. Continuer ?')) {
                    return;
                }
            }

            // Arr√™ter toute lecture en cours
            speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text.substring(0, 300));
            utterance.rate = parseFloat(elements.speed.value);
            
            // Essayer de trouver une voix homme
            const voices = speechSynthesis.getVoices();
            const hommeVoice = voices.find(voice => 
                voice.lang.includes('fr') && 
                (voice.name.toLowerCase().includes('homme') ||
                 voice.name.toLowerCase().includes('male') ||
                 voice.name.toLowerCase().includes('man'))
            );

            if (hommeVoice) {
                utterance.voice = hommeVoice;
                console.log('Utilisation de la voix homme:', hommeVoice.name);
            }

            this.disabled = true;
            this.textContent = 'üîä Lecture...';

            utterance.onend = () => {
                this.disabled = false;
                this.textContent = '‚ñ∂Ô∏è √âcouter l\'aper√ßu';
            };

            utterance.onerror = (error) => {
                console.error('Erreur de lecture:', error);
                this.disabled = false;
                this.textContent = '‚ñ∂Ô∏è √âcouter l\'aper√ßu';
                alert('Erreur de lecture. G√©n√©rez l\'audio MP3 √† la place.');
            };

            speechSynthesis.speak(utterance);
        });

        // G√©n√©rer l'audio MP3 avec voix homme
        elements.generateBtn.addEventListener('click', async function() {
            const text = elements.textInput.value.trim();
            
            if (!text) {
                alert('Veuillez entrer du texte d\'abord');
                return;
            }

            if (text.length > 500) {
                alert('Texte trop long. Veuillez r√©duire √† 500 caract√®res maximum.');
                return;
            }

            // Utiliser la cl√© API
            const apiKey = userApiKey || DEMO_API_KEY;
            
            // Afficher le chargement
            elements.loading.style.display = 'block';
            elements.result.style.display = 'none';
            this.disabled = true;
            this.textContent = '‚è≥ G√©n√©ration...';

            try {
                // G√©n√©rer avec VoiceRSS (configuration pour voix homme)
                const audioBlob = await generateHommeVoiceWithVoiceRSS(text, apiKey);
                
                // Cr√©er l'URL pour l'audio
                if (currentAudioUrl) {
                    URL.revokeObjectURL(currentAudioUrl);
                }
                currentAudioUrl = URL.createObjectURL(audioBlob);
                currentAudioBlob = audioBlob;
                
                // Configurer le lecteur audio
                elements.audioPlayer.src = currentAudioUrl;
                
                // Mettre √† jour les informations
                const fileSize = (audioBlob.size / 1024).toFixed(1);
                const estimatedDuration = Math.ceil(text.length / 12);
                
                elements.fileSize.textContent = `(${fileSize} KB)`;
                elements.sizeInfo.textContent = `${fileSize} KB`;
                elements.durationInfo.textContent = `${estimatedDuration} secondes`;
                
                // Configurer le lien de t√©l√©chargement
                elements.downloadLink.href = currentAudioUrl;
                elements.downloadLink.download = `voix-homme-${new Date().toISOString().slice(0,10)}.mp3`;
                elements.downloadLink.onclick = function(e) {
                    setTimeout(() => {
                        URL.revokeObjectURL(currentAudioUrl);
                    }, 100);
                };
                
                // Activer le bouton de t√©l√©chargement
                elements.downloadBtn.disabled = false;
                elements.downloadBtn.onclick = () => {
                    const link = document.createElement('a');
                    link.href = currentAudioUrl;
                    link.download = `voix-homme-${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.mp3`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                };
                
                // Afficher le r√©sultat
                elements.loading.style.display = 'none';
                elements.result.style.display = 'block';
                
                // Jouer automatiquement
                setTimeout(() => {
                    elements.audioPlayer.play().catch(e => {
                        console.log("Cliquez sur play pour √©couter");
                    });
                }, 1000);
                
            } catch (error) {
                console.error('Erreur:', error);
                elements.loading.style.display = 'none';
                this.disabled = false;
                this.textContent = 'üéµ G√©n√©rer Audio Homme';
                
                alert(`Erreur : ${error.message}\n\nVeuillez v√©rifier votre connexion internet et r√©essayer.`);
            }
        });

        // Fonction pour g√©n√©rer avec VoiceRSS (configuration homme)
        async function generateHommeVoiceWithVoiceRSS(text, apiKey) {
            return new Promise((resolve, reject) => {
                // Configuration pour voix homme
                const voiceConfig = HOMME_VOICE_CONFIGS[selectedVoiceType];
                const speed = parseFloat(elements.speed.value);
                
                // Convertir la vitesse (0.7-1.3) √† -10 √† 10 pour VoiceRSS
                const speedParam = Math.round((speed - 0.7) * (20/0.6)) - 10;
                
                // Ajuster la vitesse selon la configuration homme
                const finalSpeed = speedParam + voiceConfig.speed;
                
                // Limiter les valeurs
                const limitedSpeed = Math.max(-10, Math.min(10, finalSpeed));
                
                // Param√®tres optimis√©s pour voix homme
                const params = {
                    key: apiKey,
                    src: text.substring(0, 300), // Limiter pour qualit√©
                    hl: voiceConfig.language, // Utiliser la langue de la configuration homme
                    r: limitedSpeed, // Vitesse ajust√©e pour voix homme
                    c: elements.format.value,
                    f: '44khz_16bit_stereo',
                    ssml: 'false',
                    b64: 'false'
                };
                
                // Construire l'URL
                const queryString = Object.keys(params)
                    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
                    .join('&');
                
                const apiUrl = `https://api.voicerss.org/?${queryString}`;
                
                console.log('G√©n√©ration avec configuration homme:', voiceConfig.name);
                console.log('Param√®tres:', { language: voiceConfig.language, speed: limitedSpeed });
                
                // Timeout
                const timeout = setTimeout(() => {
                    reject(new Error('D√©lai d√©pass√©. L\'API est lente.'));
                }, 15000);
                
                // T√©l√©charger l'audio
                fetch(apiUrl)
                    .then(response => {
                        clearTimeout(timeout);
                        if (!response.ok) {
                            throw new Error(`Erreur API: ${response.status}`);
                        }
                        return response.blob();
                    })
                    .then(blob => {
                        if (blob.size < 100) {
                            throw new Error('Fichier audio invalide');
                        }
                        resolve(blob);
                    })
                    .catch(error => {
                        clearTimeout(timeout);
                        reject(new Error(`√âchec de g√©n√©ration: ${error.message}`));
                    });
            });
        }

        // Effacer le texte
        elements.clearBtn.addEventListener('click', function() {
            elements.textInput.value = '';
            updateCharCount();
            elements.textInput.focus();
        });

        // ============================================
        // INITIALISATION FINALE
        // ============================================

        // Initialiser la valeur du slider
        updateSpeedValue();
        
        // Initialiser le nom de la voix
        updateVoiceInfo();

        // Message de bienvenue
        console.log(`
        ========================================
        SYNTH√àSE VOCALE - VOIX HOMME
        ========================================
        Cette version est configur√©e uniquement pour
        g√©n√©rer des voix d'homme naturelles.
        
        Configuration recommand√©e :
        ‚Ä¢ Langue: Fran√ßais Canadien (fr-ca)
        ‚Ä¢ Voix: "Homme Profond"
        ‚Ä¢ Limite: 300 caract√®res
        
        Bonne utilisation !
        ========================================
        `);
    </script>
</body>
</html>
